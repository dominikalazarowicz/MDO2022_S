Started by user Bartosz
Obtained ./ITE/GCL08/BT403177/Lab05/JenkinsFile from git https://github.com/InzynieriaOprogramowaniaAGH/MDO2022_S
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/Projekt
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
The recommended git tool is: git
No credentials specified
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/Projekt/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/InzynieriaOprogramowaniaAGH/MDO2022_S # timeout=10
Fetching upstream changes from https://github.com/InzynieriaOprogramowaniaAGH/MDO2022_S
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
 > git fetch --tags --force --progress -- https://github.com/InzynieriaOprogramowaniaAGH/MDO2022_S +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/BT403177^{commit} # timeout=10
Checking out Revision dfa45c6672ffc95dfa5142eb3a33c40c43f27ca5 (refs/remotes/origin/BT403177)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f dfa45c6672ffc95dfa5142eb3a33c40c43f27ca5 # timeout=10
Commit message: "BT403177"
 > git rev-list --no-walk dfa45c6672ffc95dfa5142eb3a33c40c43f27ca5 # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Clone)
[Pipeline] echo
Cloning apollo-server
[Pipeline] sh
+ docker volume create input-volume
input-volume
[Pipeline] sh
+ docker rm tempContainer
Error: No such container: tempContainer
+ true
[Pipeline] sh
+ docker run --rm --name tempContainer --mount type=volume,src=input-volume,dst=/myapp node bash -c cd ~/; ls apollo-server || git clone https://github.com/apollographql/apollo-server ;ls apollo-server; cp -R apollo-server /myapp; ls /myapp
ls: cannot access 'apollo-server': No such file or directory
Cloning into 'apollo-server'...
CHANGELOG.md
CONTRIBUTING.md
DEVELOPMENT.md
LICENSE
README.md
ROADMAP.md
codecov.yml
codegen.yml
cspell-dict.txt
cspell.yaml
docs
jest.config.base.js
jest.setup.js
lerna.json
netlify.toml
package-lock.json
package.json
packages
renovate.json5
tsconfig.base.json
tsconfig.build.json
tsconfig.json
tsconfig.test.base.json
tsconfig.test.json
types
apollo-server
cropperjs
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build)
[Pipeline] echo
Buildig apollo-server with npm
[Pipeline] dir
Running in /var/jenkins_home/workspace/Projekt/ITE/GCL08/BT403177/Lab05
[Pipeline] {
[Pipeline] sh
+ docker build . -t apollo-server -f Dockerfile
Sending build context to Docker daemon  10.24kB

Step 1/3 : FROM node:alpine
 ---> c4f3fb5f722f
Step 2/3 : WORKDIR apollo-server
 ---> Using cache
 ---> ce4e05265903
Step 3/3 : RUN apk update && apk add bash && apk add git
 ---> Using cache
 ---> bf3a0899a116
Successfully built bf3a0899a116
Successfully tagged apollo-server:latest
[Pipeline] sh
+ docker volume create output-volume
output-volume
[Pipeline] sh
+ docker rm apollo-server-build
Error: No such container: apollo-server-build
+ true
[Pipeline] sh
+ docker run --rm --name apollo-server-build --mount type=volume,src=input-volume,dst=/myapp --mount type=volume,src=output-volume,dst=/myapp_build apollo-server bash -c cd /myapp/apollo-server && npm install; cp -R /myapp/apollo-server /myapp_build

> postinstall
> lerna run prepare && npm run compile

lerna notice cli v4.0.0
lerna info versioning independent
lerna info Executing command in 1 package: "npm run prepare"
lerna info run Ran npm script 'prepare' in 'apollo-server-env' in 9.2s:

> apollo-server-env@4.2.1 prepare
> npm run clean && npm run compile


> apollo-server-env@4.2.1 clean
> git clean -fdX -- dist

Removing dist/

> apollo-server-env@4.2.1 compile
> tsc && cp src/*.d.ts dist

lerna success run Ran npm script 'prepare' in 1 package in 9.2s:
lerna success - apollo-server-env

> compile
> tsc --build tsconfig.build.json


up to date, audited 1994 packages in 41s

104 packages are looking for funding
  run `npm fund` for details

16 vulnerabilities (4 moderate, 9 high, 3 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
npm notice 
npm notice New minor version of npm available! 8.11.0 -> 8.12.1
npm notice Changelog: <https://github.com/npm/cli/releases/tag/v8.12.1>
npm notice Run `npm install -g npm@8.12.1` to update!
npm notice 
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Test)
[Pipeline] echo
Testing apollo-server with npm
[Pipeline] dir
Running in /var/jenkins_home/workspace/Projekt/ITE/GCL08/BT403177/Lab05
[Pipeline] {
[Pipeline] sh
+ docker rm apollo-server-test
Error: No such container: apollo-server-test
+ true
[Pipeline] sh
+ docker run --rm --name apollo-server-test --mount type=volume,src=input-volume,dst=/myapp_test apollo-server bash -c cd /myapp_test/apollo-server && npm test || true

> pretest
> tsc --build tsconfig.json


> test
> jest --verbose

ts-jest[ts-compiler] (WARN) [96mpackages/apollo-datasource-rest/src/HTTPCache.ts[0m:[93m3[0m:[93m30[0m - [91merror[0m[90m TS7016: [0mCould not find a declaration file for module 'http-cache-semantics'. '/myapp_test/apollo-server/node_modules/http-cache-semantics/index.js' implicitly has an 'any' type.
  Try `npm i --save-dev @types/http-cache-semantics` if it exists or add a new declaration (.d.ts) file containing `declare module 'http-cache-semantics';`

[7m3[0m import CachePolicy = require('http-cache-semantics');
[7m [0m [91m                             ~~~~~~~~~~~~~~~~~~~~~~[0m
PASS packages/apollo-datasource-rest/src/__tests__/RESTDataSource.test.ts (14.08 s)
  RESTDataSource
    constructing requests
      âœ“ interprets paths relative to the base URL (30 ms)
      âœ“ interprets paths with a leading slash relative to the base URL (10 ms)
      âœ“ adds a trailing slash to the base URL if needed (6 ms)
      âœ“ allows resolving a base URL asynchronously (4 ms)
      âœ“ allows passing in query string parameters (9 ms)
      âœ“ allows setting default query string parameters (2 ms)
      âœ“ allows setting default fetch options (2 ms)
      âœ“ allows setting request headers (8 ms)
      âœ“ serializes a request body that is an object as JSON (16 ms)
      âœ“ serializes a request body that is an array as JSON (14 ms)
      âœ“ serializes a request body that has a toJSON method as JSON (2 ms)
      âœ“ does not serialize a request body that is not an object (3 ms)
      âœ“ allows performing GET requests (4 ms)
      âœ“ allows performing POST requests (9 ms)
      âœ“ allows performing PATCH requests (4 ms)
      âœ“ allows performing PUT requests (10 ms)
      âœ“ allows performing DELETE requests (1 ms)
    response parsing
      âœ“ returns data as parsed JSON when Content-Type is application/json (1 ms)
      âœ“ returns data as parsed JSON when Content-Type is application/hal+json (13 ms)
      âœ“ returns data as parsed JSON when Content-Type ends in +json (4 ms)
      âœ“ returns data as a string when Content-Type is text/plain (3 ms)
      âœ“ attempts to return data as a string when no Content-Type header is returned (3 ms)
      âœ“ returns data as a string when response status code is 204 no content (1 ms)
      âœ“ returns empty object when response content length is 0 (1 ms)
    memoization
      âœ“ deduplicates requests with the same cache key (2 ms)
      âœ“ does not deduplicate requests with a different cache key (3 ms)
      âœ“ does not deduplicate non-GET requests (9 ms)
      âœ“ non-GET request removes memoized request with the same cache key (7 ms)
      âœ“ allows specifying a custom cache key (3 ms)
    error handling
      âœ“ throws an AuthenticationError when the response status is 401 (125 ms)
      âœ“ throws a ForbiddenError when the response status is 403 (3 ms)
      âœ“ throws an ApolloError when the response status is 500 (5 ms)
      âœ“ puts JSON error responses on the error as an object (3 ms)
    trace
      âœ“ is called once per request (18 ms)

PASS packages/apollo-server-core/src/__tests__/runQuery.test.ts (20.853 s)
  runQuery
    âœ“ returns the right result when query is a string (52 ms)
    âœ“ returns a syntax error if the query string contains one (41 ms)
    âœ“ does not call console.error if in an error occurs and debug mode is set (294 ms)
    âœ“ does not call console.error if in an error occurs and not in debug mode (7 ms)
    âœ“ returns a validation error if the query string does not pass validation (26 ms)
    âœ“ correctly passes in the rootValue (4 ms)
    âœ“ correctly evaluates a rootValue function (8 ms)
    âœ“ correctly passes in the context (4 ms)
    âœ“ passes the options to formatResponse (3 ms)
    âœ“ correctly passes in variables (and arguments) (4 ms)
    âœ“ throws an error if there are missing variables (21 ms)
    âœ“ supports yielding resolver functions (3 ms)
    âœ“ runs the correct operation when operationName is specified (2 ms)
    âœ“ uses custom field resolver (7 ms)
    request pipeline life-cycle hooks
      requestDidStart
        âœ“ called for each request (6 ms)
        âœ“ is called with the schema and schemaHash (3 ms)
      didResolveSource
        âœ“ called with the source (3 ms)
      parsingDidStart
        âœ“ called when parsing will result in an error (2 ms)
        âœ“ called when a successful parse happens (13 ms)
      executionDidStart
        âœ“ called when execution starts (26 ms)
        executionDidEnd
          âœ“ works as a listener on an object returned from "executionDidStart" (3 ms)
        willResolveField
          âœ“ called when resolving a field starts (9 ms)
          âœ“ called once for each field being resolved (5 ms)
          âœ“ calls the end handler (14 ms)
          âœ“ calls the end handler for each field being resolved (3 ms)
          âœ“ uses the custom "fieldResolver" when defined (29 ms)
          receives correct resolver parameter object
            âœ“ receives undefined parent when there is no parent (5 ms)
            âœ“ receives the parent when there is one (10 ms)
            âœ“ receives context (7 ms)
            âœ“ receives arguments (7 ms)
      didEncounterErrors
        âœ“ called when an error occurs (4 ms)
        âœ“ called when an error occurs in execution (38 ms)
        âœ“ not called when an error does not occur (2 ms)
      ordering
        âœ“ calls hooks in the expected order (10 ms)
    parsing and validation cache
      âœ“ validates each time when the documentStore is not present (5 ms)
      âœ“ caches the DocumentNode in the documentStore when instrumented (16 ms)
      âœ“ the documentStore calculates the DocumentNode's length by its JSON.stringify'd representation (64 ms)
    async_hooks
      âœ“ does not break async_hook call stack (4 ms)

PASS packages/apollo-server-core/src/plugin/usageReporting/__tests__/stats.test.ts (9.543 s)
  Check query latency stats when
    âœ“ adding a single trace (17 ms)
    âœ“ adding a fully cached trace (23 ms)
    âœ“ adding a public cached trace (4 ms)
    âœ“ adding a private cached trace (5 ms)
    âœ“ adding a persisted hit trace (5 ms)
    âœ“ adding a persisted miss trace (4 ms)
    âœ“ adding a forbidden trace (3 ms)
    âœ“ adding a registered trace (3 ms)
    âœ“ adding an errored trace  (13 ms)
    âœ“ merging errored traces (6 ms)
    âœ“ merging non-errored traces (7 ms)
  Check type stats
    âœ“ add single non-federated trace (6 ms)
    âœ“ add multiple non-federated trace (18 ms)
    âœ“ add multiple federated trace (5 ms)
    âœ“ add multiple errored traces trace (5 ms)

PASS packages/apollo-server-core/src/plugin/usageReporting/__tests__/plugin.test.ts (24.01 s)
  end-to-end
    âœ“ basic tracing (177 ms)
    âœ“ fails parse for non-parsable gql (98 ms)
    âœ“ validation fails for invalid operation (57 ms)
    âœ“ unknown operation error if not specified (40 ms)
    âœ“ handles anonymous operation (79 ms)
    âœ“ handles named operation (55 ms)
    includeRequest
      âœ“ include based on operation name (60 ms)
      âœ“ exclude based on operation name (79 ms)
    fieldLevelInstrumentation
      âœ“ include based on operation name (35 ms)
      âœ“ exclude based on operation name (64 ms)
      passing a number
        âœ“ RNG returns a small number (42 ms)
        âœ“ RNG returns a large number (49 ms)
  sendHeaders makeHTTPRequestHeaders helper
    âœ“ sendHeaders defaults to hiding all (2 ms)
    âœ“ sendHeaders.all and sendHeaders.none (1 ms)
    âœ“ invalid inputs for sendHeaders.all and sendHeaders.none (1 ms)
    âœ“ test sendHeaders.exceptNames (1 ms)
    âœ“ test sendHeaders.onlyNames (1 ms)
    âœ“ authorization, cookie, and set-cookie headers should never be sent (1 ms)

FAIL packages/apollo-server-koa/src/__tests__/ApolloServer.test.ts (15.836 s)
  apollo-server-koa
    ApolloServer
      constructor
        validation rules
          âœ“ accepts additional rules (714 ms)
          âœ“ allows introspection by default (54 ms)
          âœ“ prevents introspection by default during production (77 ms)
          âœ“ allows introspection to be enabled explicitly (127 ms)
          âœ“ prohibits providing a gateway in addition to schema/typeDefs/resolvers (11 ms)
        appropriate error for bad user input
          âœ“ variable coercion errors (82 ms)
          âœ“ catches required type variable error and returns UserInputError (50 ms)
          âœ“ catches required List type variable error and returns UserInputError (88 ms)
          âœ“ catches non-null type variable error and returns UserInputError (72 ms)
          âœ“ catches non-null List type variable error and returns UserInputError (109 ms)
          âœ“ catches List of non-null type variable error and returns UserInputError (45 ms)
        schema creation
          âœ“ accepts typeDefs and resolvers (28 ms)
          âœ“ accepts a gateway's schema and calls its executor (23 ms)
          âœ“ rejected load promise is thrown by server.start (4 ms)
          âœ“ not calling start causes a clear error (23 ms)
          âœ“ uses schema over resolvers + typeDefs (26 ms)
          âœ“ allows mocks as boolean (29 ms)
          âœ“ allows mocks as an object (39 ms)
          âœ“ allows mocks as an object without overriding the existing resolvers (87 ms)
      Plugins
        âœ“ works when using executeOperation (25 ms)
        âœ“ returns correct status code for a normal operation (27 ms)
        âœ“ allows setting a custom status code for an error (40 ms)
        âœ“ preserves user-added "extensions" in the response when parsing errors occur (49 ms)
        âœ“ preserves user-added "extensions" in the response when validation errors occur (39 ms)
      formatError
        âœ“ wraps thrown error from validation rules (107 ms)
        âœ“ works with errors similar to GraphQL errors, such as yup (65 ms)
      lifecycle
        âœ“ errors thrown in plugins call formatError and are wrapped (57 ms)
        âœ“ propagates error codes in production (37 ms)
        âœ“ propagates error codes with null response in production (62 ms)
        âœ“ shows ApolloError extensions in extensions (only!) (56 ms)
        for Apollo usage reporting
          traces
            âœ• cachePolicy (23 ms)
            âœ• does not expose stack (8 ms)
            âœ• sets the trace key to operationName when it is defined (2 ms)
            âœ• sets the trace key to unknown operation for missing operation (5 ms)
            âœ• sets the trace key to parse failure when non-parsable gql (3 ms)
            âœ• sets the trace key to validation failure when invalid operation (2 ms)
            âœ• sets the trace key to "-" when operationName is undefined (3 ms)
            âœ• doesn't resort to query body signature on `didResolveOperation` error (2 ms)
            âœ• doesn't internal server error on an APQ (6 ms)
            error munging
              âœ• undefined error (3 ms)
              rewriteError
                âœ• new error (8 ms)
                âœ• modified error (22 ms)
                âœ• nulled error (14 ms)
        context field
          âœ“ defers context eval with thunk until after options creation (83 ms)
          context cloning
            âœ“ clones the context for request pipeline requests (35 ms)
            âœ“ for every request with executeOperation (77 ms)
          as a function
            âœ“ can accept and return `req` (48 ms)
            âœ“ can accept nothing and return an empty object (21 ms)
            âœ“ can be an async function (18 ms)
            âœ“ returns thrown context error as a valid graphql result (43 ms)
          as an object
            âœ“ can be an empty object (17 ms)
            âœ“ can contain arbitrary values (13 ms)
      Persisted Queries
        âœ“ returns PersistedQueryNotFound on the first try (38 ms)
        âœ“ returns result on the second try (41 ms)
        âœ“ returns result on the persisted query (33 ms)
        âœ“ returns error when hash does not match (36 ms)
        âœ“ returns correct result for persisted query link (63 ms)
        âœ“ returns correct result for persisted query link using get request (34 ms)
      usage reporting
        graphql server functions even when Apollo servers are down
          âœ• with retryable error (1 ms)
          âœ• with network error (1 ms)
          âœ• with non-retryable error (1 ms)
      Federated tracing
        âœ“ doesn't include federated trace without the special header (49 ms)
        âœ“ doesn't include federated trace without _Service in the schema (48 ms)
        âœ“ reports a total duration that is longer than the duration of its resolvers (75 ms)
        âœ“ includes errors in federated trace (61 ms)
      Response caching
        âœ“ basic caching (365 ms)
      Gateway
        âœ“ receives schema updates from the gateway (with document store: true) (78 ms)
        âœ“ receives schema updates from the gateway (with document store: false) (59 ms)
        âœ“ passes apollo data to the gateway (226 ms)
        âœ“ unsubscribes from schema update on close (16 ms)
        âœ“ waits until gateway has resolved a schema to respond to queries (61 ms)
        âœ“ can serve multiple active schemas simultaneously during a schema rollover (145 ms)
      renderLandingPage
        âœ“ defaults to LocalDefault (53 ms)
        âœ“ can specify version for LocalDefault (42 ms)
        âœ“ can install playground with specific version (170 ms)
        âœ“ can be disabled (30 ms)
        basic functionality
          with non-root graphqlPath
            âœ“ basic GET works (27 ms)
            âœ“ only mounts under graphqlPath (20 ms)
            âœ“ needs the header (29 ms)
            âœ“ trailing slash works (22 ms)
          with root graphqlPath
            âœ“ basic GET works (28 ms)
            âœ“ needs the header (23 ms)
        startup errors
          âœ“ only one plugin can implement renderLandingPage (23 ms)
      CSRF prevention
        âœ“ csrfPrevention: true (135 ms)
        âœ“ csrfPrevention: {requestHeaders} (56 ms)
    constructor
      âœ“ accepts typeDefs and resolvers (15 ms)
    applyMiddleware
      âœ“ can be queried (38 ms)
      âœ“ renders landing page by default when browser requests (26 ms)
      âœ“ accepts cors configuration (26 ms)
      âœ“ accepts body parser configuration (21 ms)
      health checks
        âœ“ creates a health check endpoint (26 ms)
        âœ“ provides a callback for the health check (38 ms)
        âœ“ can disable the healthCheck (31 ms)
      errors
        âœ“ returns thrown context error as a valid graphql result (33 ms)
        âœ“ propagates error codes in dev mode (36 ms)
        âœ“ propagates error codes in production (35 ms)
        âœ“ propagates error codes with null response in production (50 ms)
    extensions
      Cache Control Headers
        âœ“ applies cacheControl Headers (39 ms)
        âœ“ contains no cacheControl Headers when uncacheable (38 ms)
        âœ“ contains private cacheControl Headers when scoped (31 ms)
        âœ“ runs when cache-control is false (33 ms)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-koa â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-koa â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-koa â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

FAIL packages/apollo-server-express/src/__tests__/ApolloServer.test.ts (17.537 s)
  apollo-server-express
    ApolloServer
      constructor
        validation rules
          âœ“ accepts additional rules (498 ms)
          âœ“ allows introspection by default (73 ms)
          âœ“ prevents introspection by default during production (71 ms)
          âœ“ allows introspection to be enabled explicitly (84 ms)
          âœ“ prohibits providing a gateway in addition to schema/typeDefs/resolvers (15 ms)
        appropriate error for bad user input
          âœ“ variable coercion errors (190 ms)
          âœ“ catches required type variable error and returns UserInputError (87 ms)
          âœ“ catches required List type variable error and returns UserInputError (102 ms)
          âœ“ catches non-null type variable error and returns UserInputError (61 ms)
          âœ“ catches non-null List type variable error and returns UserInputError (74 ms)
          âœ“ catches List of non-null type variable error and returns UserInputError (87 ms)
        schema creation
          âœ“ accepts typeDefs and resolvers (43 ms)
          âœ“ accepts a gateway's schema and calls its executor (25 ms)
          âœ“ rejected load promise is thrown by server.start (6 ms)
          âœ“ not calling start causes a clear error (45 ms)
          âœ“ uses schema over resolvers + typeDefs (85 ms)
          âœ“ allows mocks as boolean (49 ms)
          âœ“ allows mocks as an object (57 ms)
          âœ“ allows mocks as an object without overriding the existing resolvers (120 ms)
      Plugins
        âœ“ works when using executeOperation (25 ms)
        âœ“ returns correct status code for a normal operation (44 ms)
        âœ“ allows setting a custom status code for an error (31 ms)
        âœ“ preserves user-added "extensions" in the response when parsing errors occur (39 ms)
        âœ“ preserves user-added "extensions" in the response when validation errors occur (26 ms)
      formatError
        âœ“ wraps thrown error from validation rules (47 ms)
        âœ“ works with errors similar to GraphQL errors, such as yup (64 ms)
      lifecycle
        âœ“ errors thrown in plugins call formatError and are wrapped (84 ms)
        âœ“ propagates error codes in production (48 ms)
        âœ“ propagates error codes with null response in production (49 ms)
        âœ“ shows ApolloError extensions in extensions (only!) (38 ms)
        for Apollo usage reporting
          traces
            âœ• cachePolicy (13 ms)
            âœ• does not expose stack (4 ms)
            âœ• sets the trace key to operationName when it is defined (2 ms)
            âœ• sets the trace key to unknown operation for missing operation (3 ms)
            âœ• sets the trace key to parse failure when non-parsable gql (3 ms)
            âœ• sets the trace key to validation failure when invalid operation (2 ms)
            âœ• sets the trace key to "-" when operationName is undefined (2 ms)
            âœ• doesn't resort to query body signature on `didResolveOperation` error (2 ms)
            âœ• doesn't internal server error on an APQ (10 ms)
            error munging
              âœ• undefined error (2 ms)
              rewriteError
                âœ• new error (6 ms)
                âœ• modified error (9 ms)
                âœ• nulled error (9 ms)
        context field
          âœ“ defers context eval with thunk until after options creation (137 ms)
          context cloning
            âœ“ clones the context for request pipeline requests (34 ms)
            âœ“ for every request with executeOperation (30 ms)
          as a function
            âœ“ can accept and return `req` (46 ms)
            âœ“ can accept nothing and return an empty object (30 ms)
            âœ“ can be an async function (29 ms)
            âœ“ returns thrown context error as a valid graphql result (26 ms)
          as an object
            âœ“ can be an empty object (40 ms)
            âœ“ can contain arbitrary values (23 ms)
      Persisted Queries
        âœ“ returns PersistedQueryNotFound on the first try (25 ms)
        âœ“ returns result on the second try (45 ms)
        âœ“ returns result on the persisted query (80 ms)
        âœ“ returns error when hash does not match (31 ms)
        âœ“ returns correct result for persisted query link (77 ms)
        âœ“ returns correct result for persisted query link using get request (37 ms)
      usage reporting
        graphql server functions even when Apollo servers are down
          âœ• with retryable error (2 ms)
          âœ• with network error (2 ms)
          âœ• with non-retryable error (1 ms)
      Federated tracing
        âœ“ doesn't include federated trace without the special header (48 ms)
        âœ“ doesn't include federated trace without _Service in the schema (42 ms)
        âœ“ reports a total duration that is longer than the duration of its resolvers (70 ms)
        âœ“ includes errors in federated trace (77 ms)
      Response caching
        âœ“ basic caching (381 ms)
      Gateway
        âœ“ receives schema updates from the gateway (with document store: true) (87 ms)
        âœ“ receives schema updates from the gateway (with document store: false) (103 ms)
        âœ“ passes apollo data to the gateway (254 ms)
        âœ“ unsubscribes from schema update on close (20 ms)
        âœ“ waits until gateway has resolved a schema to respond to queries (49 ms)
        âœ“ can serve multiple active schemas simultaneously during a schema rollover (117 ms)
      renderLandingPage
        âœ“ defaults to LocalDefault (67 ms)
        âœ“ can specify version for LocalDefault (31 ms)
        âœ“ can install playground with specific version (138 ms)
        âœ“ can be disabled (35 ms)
        basic functionality
          with non-root graphqlPath
            âœ“ basic GET works (45 ms)
            âœ“ only mounts under graphqlPath (52 ms)
            âœ“ needs the header (35 ms)
            âœ“ trailing slash works (22 ms)
          with root graphqlPath
            âœ“ basic GET works (26 ms)
            âœ“ needs the header (24 ms)
        startup errors
          âœ“ only one plugin can implement renderLandingPage (17 ms)
      CSRF prevention
        âœ“ csrfPrevention: true (177 ms)
        âœ“ csrfPrevention: {requestHeaders} (80 ms)
    constructor
      âœ“ accepts typeDefs and resolvers (29 ms)
    applyMiddleware
      âœ“ can be queried (17 ms)
      âœ“ renders landing page by default when browser requests (16 ms)
      âœ“ accepts cors configuration (18 ms)
      âœ“ accepts body parser configuration (34 ms)
      âœ“ gives helpful error if body is not parsed (24 ms)
      health checks
        âœ“ creates a health check endpoint (55 ms)
        âœ“ provides a callback for the health check (27 ms)
        âœ“ can disable the healthCheck (14 ms)
      errors
        âœ“ returns thrown context error as a valid graphql result (34 ms)
        âœ“ propagates error codes in dev mode (39 ms)
        âœ“ propagates error codes in production (30 ms)
        âœ“ propagates error codes with null response in production (46 ms)
    extensions
      Cache Control Headers
        âœ“ applies cacheControl Headers (39 ms)
        âœ“ contains no cacheControl Headers when uncacheable (49 ms)
        âœ“ contains private cacheControl Headers when scoped (35 ms)
        âœ“ runs when cache-control is disabled (69 ms)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-express â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-express â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-express â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

PASS packages/apollo-datasource-rest/src/__tests__/HTTPCache.test.ts
  HTTPCache
    âœ“ fetches a response from the origin when not cached (40 ms)
    âœ“ returns a cached response when not expired (6 ms)
    âœ“ fetches a fresh response from the origin when expired (19 ms)
    âœ“ allows specifying a custom cache key (3 ms)
    âœ“ does not store a response to a non-GET request (1 ms)
    âœ“ does not store a response with a non-success status code
    âœ“ does not store a response without Cache-Control header
    âœ“ does not store a private response (10 ms)
    âœ“ returns a cached response when Vary header fields match (15 ms)
    âœ“ does not return a cached response when Vary header fields don't match (6 ms)
    âœ“ sets the TTL as max-age when the response does not contain revalidation headers (12 ms)
    âœ“ sets the TTL as 2 * max-age when the response contains an ETag header (1 ms)
    âœ“ revalidates a cached response when expired and returns the cached response when not modified (11 ms)
    âœ“ revalidates a cached response when expired and returns and caches a fresh response when modified (5 ms)
    âœ“ fetches a response from the origin with a custom fetch function (3 ms)
    overriding TTL
      âœ“ returns a cached response when the overridden TTL is not expired (8 ms)
      âœ“ fetches a fresh response from the origin when the overridden TTL expired (12 ms)
      âœ“ fetches a fresh response from the origin when the overridden TTL expired even if a longer max-age has been specified (4 ms)
      âœ“ does not store a response with an overridden TTL and a non-success status code (2 ms)
      âœ“ allows overriding the TTL dynamically (46 ms)
      âœ“ allows disabling caching when the TTL is 0 (falsy) (3 ms)

FAIL packages/apollo-server-fastify/src/__tests__/ApolloServer.test.ts (23.218 s)
  apollo-server-fastify
    ApolloServer
      constructor
        validation rules
          âœ“ accepts additional rules (661 ms)
          âœ“ allows introspection by default (90 ms)
          âœ“ prevents introspection by default during production (65 ms)
          âœ“ allows introspection to be enabled explicitly (150 ms)
          âœ“ prohibits providing a gateway in addition to schema/typeDefs/resolvers (16 ms)
        appropriate error for bad user input
          âœ“ variable coercion errors (109 ms)
          âœ“ catches required type variable error and returns UserInputError (83 ms)
          âœ“ catches required List type variable error and returns UserInputError (170 ms)
          âœ“ catches non-null type variable error and returns UserInputError (211 ms)
          âœ“ catches non-null List type variable error and returns UserInputError (117 ms)
          âœ“ catches List of non-null type variable error and returns UserInputError (64 ms)
        schema creation
          âœ“ accepts typeDefs and resolvers (75 ms)
          âœ“ accepts a gateway's schema and calls its executor (69 ms)
          âœ“ rejected load promise is thrown by server.start (7 ms)
          âœ“ not calling start causes a clear error (34 ms)
          âœ“ uses schema over resolvers + typeDefs (61 ms)
          âœ“ allows mocks as boolean (82 ms)
          âœ“ allows mocks as an object (99 ms)
          âœ“ allows mocks as an object without overriding the existing resolvers (150 ms)
      Plugins
        âœ“ works when using executeOperation (73 ms)
        âœ“ returns correct status code for a normal operation (66 ms)
        âœ“ allows setting a custom status code for an error (95 ms)
        âœ“ preserves user-added "extensions" in the response when parsing errors occur (93 ms)
        âœ“ preserves user-added "extensions" in the response when validation errors occur (84 ms)
      formatError
        âœ“ wraps thrown error from validation rules (59 ms)
        âœ“ works with errors similar to GraphQL errors, such as yup (120 ms)
      lifecycle
        âœ“ errors thrown in plugins call formatError and are wrapped (72 ms)
        âœ“ propagates error codes in production (68 ms)
        âœ“ propagates error codes with null response in production (67 ms)
        âœ“ shows ApolloError extensions in extensions (only!) (76 ms)
        for Apollo usage reporting
          traces
            âœ• cachePolicy (13 ms)
            âœ• does not expose stack (7 ms)
            âœ• sets the trace key to operationName when it is defined (3 ms)
            âœ• sets the trace key to unknown operation for missing operation (3 ms)
            âœ• sets the trace key to parse failure when non-parsable gql (2 ms)
            âœ• sets the trace key to validation failure when invalid operation (3 ms)
            âœ• sets the trace key to "-" when operationName is undefined (3 ms)
            âœ• doesn't resort to query body signature on `didResolveOperation` error (2 ms)
            âœ• doesn't internal server error on an APQ (15 ms)
            error munging
              âœ• undefined error (2 ms)
              rewriteError
                âœ• new error (12 ms)
                âœ• modified error (16 ms)
                âœ• nulled error (5 ms)
        context field
          âœ“ defers context eval with thunk until after options creation (132 ms)
          context cloning
            âœ“ clones the context for request pipeline requests (106 ms)
            âœ“ for every request with executeOperation (66 ms)
          as a function
            âœ“ can accept and return `req` (108 ms)
            âœ“ can accept nothing and return an empty object (65 ms)
            âœ“ can be an async function (92 ms)
            âœ“ returns thrown context error as a valid graphql result (53 ms)
          as an object
            âœ“ can be an empty object (58 ms)
            âœ“ can contain arbitrary values (72 ms)
      Persisted Queries
        âœ“ returns PersistedQueryNotFound on the first try (85 ms)
        âœ“ returns result on the second try (93 ms)
        âœ“ returns result on the persisted query (96 ms)
        âœ“ returns error when hash does not match (77 ms)
        âœ“ returns correct result for persisted query link (155 ms)
        âœ“ returns correct result for persisted query link using get request (111 ms)
      usage reporting
        graphql server functions even when Apollo servers are down
          âœ• with retryable error (3 ms)
          âœ• with network error (1 ms)
          âœ• with non-retryable error (1 ms)
      Federated tracing
        âœ“ doesn't include federated trace without the special header (90 ms)
        âœ“ doesn't include federated trace without _Service in the schema (77 ms)
        âœ“ reports a total duration that is longer than the duration of its resolvers (98 ms)
        âœ“ includes errors in federated trace (134 ms)
      Response caching
        âœ“ basic caching (465 ms)
      Gateway
        âœ“ receives schema updates from the gateway (with document store: true) (138 ms)
        âœ“ receives schema updates from the gateway (with document store: false) (140 ms)
        âœ“ passes apollo data to the gateway (228 ms)
        âœ“ unsubscribes from schema update on close (67 ms)
        âœ“ waits until gateway has resolved a schema to respond to queries (52 ms)
        âœ“ can serve multiple active schemas simultaneously during a schema rollover (201 ms)
      renderLandingPage
        âœ“ defaults to LocalDefault (160 ms)
        âœ“ can specify version for LocalDefault (122 ms)
        âœ“ can install playground with specific version (119 ms)
        âœ“ can be disabled (69 ms)
        basic functionality
          with non-root graphqlPath
            âœ“ basic GET works (126 ms)
            âœ“ only mounts under graphqlPath (99 ms)
            âœ“ needs the header (67 ms)
            âœ“ trailing slash works (79 ms)
          with root graphqlPath
            âœ“ basic GET works (65 ms)
            âœ“ needs the header (65 ms)
        startup errors
          âœ“ only one plugin can implement renderLandingPage (32 ms)
      CSRF prevention
        âœ“ csrfPrevention: true (271 ms)
        âœ“ csrfPrevention: {requestHeaders} (111 ms)
    constructor
      âœ“ accepts typeDefs and resolvers (48 ms)
    createGraphQLServerOptions
      âœ“ provides FastifyRequest and FastifyReply to ContextFunction (78 ms)
    applyMiddleware
      âœ“ can be queried (77 ms)
      âœ“ renders landing page by default when browser requests (81 ms)
      âœ“ accepts cors configuration (121 ms)
      health checks
        âœ“ creates a health check endpoint (112 ms)
        âœ“ provides a callback for the health check (66 ms)
        âœ“ can disable the healthCheck (78 ms)
      errors
        âœ“ returns thrown context error as a valid graphql result (107 ms)
        âœ“ propagates error codes in dev mode (90 ms)
        âœ“ propagates error codes in production (69 ms)
        âœ“ propagates error codes with null response in production (105 ms)
    extensions
      Cache Control Headers
        âœ“ applies cacheControl Headers (106 ms)
        âœ“ contains no cacheControl Headers when uncacheable (96 ms)
        âœ“ contains private cacheControl Headers when scoped (92 ms)
        âœ“ runs when cache-control is false (66 ms)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-fastify â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-fastify â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-fastify â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

PASS packages/apollo-server-core/src/plugin/cacheControl/__tests__/cacheControlDirective.test.ts
  @cacheControl directives
    âœ“ should set maxAge: 0 and no scope for a field without cache hints (108 ms)
    âœ“ should set maxAge: 0 and no scope for a top-level scalar field without cache hints (10 ms)
    âœ“ should set maxAge to the default and no scope for a field without cache hints (13 ms)
    âœ“ should set the specified maxAge from a cache hint on the field (18 ms)
    âœ“ should set the specified maxAge for a field from a cache hint on the target type (20 ms)
    âœ“ should set the specified maxAge for a field from a cache hint on the target type extension (33 ms)
    âœ“ should overwrite the default maxAge when maxAge=0 is specified on the type (28 ms)
    âœ“ should override the maxAge from the target type with that specified on a field (27 ms)
    âœ“ should override the maxAge from the target type with that specified on a field, keeping the scope (11 ms)
    âœ“ should override the scope from the target type with that specified on a field (12 ms)
    âœ“ inheritMaxAge (58 ms)
    âœ“ inheritMaxAge docs examples (36 ms)
    âœ“ inheritMaxAge can be combined with scope (59 ms)
    âœ“ inheritMaxAge on types (42 ms)
    âœ“ scalars can inherit from grandparents (43 ms)

ts-jest[ts-compiler] (WARN) [96mpackages/apollo-server-core/src/plugin/drainHttpServer/__tests__/stoppable.test.ts[0m:[93m37[0m:[93m1[0m - [91merror[0m[90m TS1371: [0mThis import is never used as a value and must use 'import type' because 'importsNotUsedAsValues' is set to 'error'.

[7m37[0m import { AddressInfo } from 'net';
[7m  [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
PASS packages/apollo-server-core/src/plugin/drainHttpServer/__tests__/stoppable.test.ts (6.442 s)
  http.Server
    âœ“ with a 0.5s grace period (530 ms)
    âœ“ with requests in-flight (549 ms)
    âœ“ with in-flights finishing before grace period ends (1037 ms)
    .close()
      âœ“ without keep-alive connections (65 ms)
      âœ“ with keep-alive connections (20 ms)
    Stopper
      âœ“ without keep-alive connections (21 ms)
      âœ“ with keep-alive connections (11 ms)
  https.Server
    âœ“ with a 0.5s grace period (566 ms)
    âœ“ with requests in-flight (571 ms)
    .close()
      âœ“ without keep-alive connections (344 ms)
      âœ“ with keep-alive connections (21 ms)
    Stopper
      âœ“ without keep-alive connections (23 ms)
      âœ“ with keep-alive connections (28 ms)

PASS packages/apollo-server-azure-functions/src/__tests__/azureFunctionApollo.test.ts (8.466 s)
  integration:AzureFunctions
    âœ“ can append CORS headers to GET request (36 ms)
    âœ“ can handle OPTIONS request with CORS headers (20 ms)
    âœ“ can return landing page (17 ms)
    apolloServer
      âœ“ calls serverWillStart before serving a request (16 ms)
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (90 ms)
        âœ“ throws an error if POST body is empty (24 ms)
        âœ“ throws an error if POST body is missing even with content-type (23 ms)
        âœ“ throws an error if invalid content-type (92 ms)
        âœ“ throws an error if POST operation is missing (88 ms)
        âœ“ throws an error if POST operation is empty (159 ms)
        âœ“ throws an error if POST JSON is malformed (28 ms)
        âœ“ throws an error if GET query is missing (56 ms)
        âœ“ can handle a basic GET request (68 ms)
        âœ“ can handle a basic implicit GET request (21 ms)
        âœ“ throws error if trying to use mutation using GET request (94 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (42 ms)
        âœ“ can handle a GET request with variables (56 ms)
        âœ“ can handle a basic request (29 ms)
        âœ“ cache-control not set without any hints (24 ms)
        âœ“ cache-control set with dynamic hint (20 ms)
        âœ“ cache-control set with defaultMaxAge (45 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (25 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (39 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (31 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (23 ms)
        âœ“ can handle a request with variables (20 ms)
        âœ“ can handle a request with variables as string (27 ms)
        âœ“ can handle a request with variables as an invalid string (42 ms)
        âœ“ can handle a request with operationName (32 ms)
        âœ“ can handle introspection request (111 ms)
        âœ“ does not accept a query AST (21 ms)
        âœ“ can handle batch requests (19 ms)
        âœ“ can handle batch requests (19 ms)
        âœ“ can handle batch requests in parallel (252 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (57 ms)
        âœ“ clones batch context (35 ms)
        âœ“ executes batch context if it is a function (38 ms)
        âœ“ can handle a request with a mutation (61 ms)
        âœ“ applies the formatResponse function (19 ms)
        âœ“ passes the context to the resolver (26 ms)
        âœ“ passes the rootValue to the resolver (34 ms)
        âœ“ passes the rootValue function result to the resolver (44 ms)
        âœ“ returns errors (51 ms)
        âœ“ applies formatError if provided (57 ms)
        âœ“ formatError receives error that passes instanceof checks (22 ms)
        âœ“ allows for custom error formatting to sanitize (43 ms)
        âœ“ allows for custom error formatting to elaborate (77 ms)
        âœ“ sends internal server error when formatError fails (30 ms)
        âœ“ applies additional validationRules (43 ms)
        cors enabled by default
          âœ“ for POST request (21 ms)
          âœ“ for OPTIONS preflight request (26 ms)
      status code
        âœ“ allows setting a custom status code (31 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (40 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (19 ms)
        âœ“ errors when version is not specified (71 ms)
        âœ“ errors when version is unsupported (53 ms)
        âœ“ errors when hash is mismatched (21 ms)
        âœ“ returns PersistedQueryNotFound on the first try (44 ms)
        âœ“ returns result on the second try (83 ms)
        âœ“ returns with batched persisted queries (51 ms)
        âœ“ returns result on the persisted query (31 ms)
        âœ“ returns error when hash does not match (53 ms)
        âœ“ returns correct result using get request (40 ms)
    health checks
      âœ“ creates a health check endpoint (18 ms)
      âœ“ provides a callback for the health check (18 ms)
      âœ“ returns a 503 if health check fails (26 ms)

PASS packages/apollo-server-core/src/__tests__/ApolloServerBase.test.ts (6.235 s)
  ApolloServerBase construction
    âœ“ succeeds when a valid configuration options are provided to typeDefs and resolvers (623 ms)
    âœ“ succeeds when a valid GraphQLSchema is provided to the schema configuration option (59 ms)
    âœ“ succeeds when passed a graphVariant in construction (77 ms)
    âœ“ throws when a GraphQLSchema is not provided to the schema configuration option (25 ms)
    âœ“ throws when the no schema configuration option is provided (3 ms)
  ApolloServerBase start
    âœ“ start throws on startup error (284 ms)
    âœ“ stop throws on stop error (51 ms)
    âœ“ execute throws redacted message on serverless startup error (37 ms)
  ApolloServerBase executeOperation
    âœ“ returns error information without details by default (173 ms)
    âœ“ returns error information with details when debug is enabled (29 ms)
    âœ“ works with string (35 ms)
    âœ“ works with AST (57 ms)
    âœ“ parse errors (23 ms)
    âœ“ passes its second argument to context function (23 ms)

FAIL packages/apollo-server-hapi/src/__tests__/ApolloServer.test.ts (17.404 s)
  apollo-server-hapi
    ApolloServer
      constructor
        validation rules
          âœ“ accepts additional rules (669 ms)
          âœ“ allows introspection by default (103 ms)
          âœ“ prevents introspection by default during production (99 ms)
          âœ“ allows introspection to be enabled explicitly (122 ms)
          âœ“ prohibits providing a gateway in addition to schema/typeDefs/resolvers (39 ms)
        appropriate error for bad user input
          âœ“ variable coercion errors (165 ms)
          âœ“ catches required type variable error and returns UserInputError (190 ms)
          âœ“ catches required List type variable error and returns UserInputError (189 ms)
          âœ“ catches non-null type variable error and returns UserInputError (158 ms)
          âœ“ catches non-null List type variable error and returns UserInputError (88 ms)
          âœ“ catches List of non-null type variable error and returns UserInputError (77 ms)
        schema creation
          âœ“ accepts typeDefs and resolvers (63 ms)
          âœ“ accepts a gateway's schema and calls its executor (43 ms)
          âœ“ rejected load promise is thrown by server.start (12 ms)
          âœ“ not calling start causes a clear error (37 ms)
          âœ“ uses schema over resolvers + typeDefs (84 ms)
          âœ“ allows mocks as boolean (69 ms)
          âœ“ allows mocks as an object (70 ms)
          âœ“ allows mocks as an object without overriding the existing resolvers (98 ms)
      Plugins
        âœ“ works when using executeOperation (140 ms)
        âœ“ returns correct status code for a normal operation (183 ms)
        âœ“ allows setting a custom status code for an error (121 ms)
        âœ“ preserves user-added "extensions" in the response when parsing errors occur (108 ms)
        âœ“ preserves user-added "extensions" in the response when validation errors occur (81 ms)
      formatError
        âœ“ wraps thrown error from validation rules (85 ms)
        âœ“ works with errors similar to GraphQL errors, such as yup (65 ms)
      lifecycle
        âœ“ errors thrown in plugins call formatError and are wrapped (193 ms)
        âœ“ propagates error codes in production (94 ms)
        âœ“ propagates error codes with null response in production (117 ms)
        âœ“ shows ApolloError extensions in extensions (only!) (94 ms)
        for Apollo usage reporting
          traces
            âœ• cachePolicy (18 ms)
            âœ• does not expose stack (2 ms)
            âœ• sets the trace key to operationName when it is defined (2 ms)
            âœ• sets the trace key to unknown operation for missing operation (34 ms)
            âœ• sets the trace key to parse failure when non-parsable gql (2 ms)
            âœ• sets the trace key to validation failure when invalid operation (2 ms)
            âœ• sets the trace key to "-" when operationName is undefined (3 ms)
            âœ• doesn't resort to query body signature on `didResolveOperation` error (4 ms)
            âœ• doesn't internal server error on an APQ (12 ms)
            error munging
              âœ• undefined error (3 ms)
              rewriteError
                âœ• new error (6 ms)
                âœ• modified error (2 ms)
                âœ• nulled error (2 ms)
        context field
          âœ“ defers context eval with thunk until after options creation (147 ms)
          context cloning
            âœ“ clones the context for request pipeline requests (115 ms)
            âœ“ for every request with executeOperation (107 ms)
          as a function
            âœ“ can accept and return `req` (120 ms)
            âœ“ can accept nothing and return an empty object (69 ms)
            âœ“ can be an async function (60 ms)
            âœ“ returns thrown context error as a valid graphql result (122 ms)
          as an object
            âœ“ can be an empty object (94 ms)
            âœ“ can contain arbitrary values (59 ms)
      Persisted Queries
        âœ“ returns PersistedQueryNotFound on the first try (60 ms)
        âœ“ returns result on the second try (59 ms)
        âœ“ returns result on the persisted query (52 ms)
        âœ“ returns error when hash does not match (49 ms)
        âœ“ returns correct result for persisted query link (68 ms)
        âœ“ returns correct result for persisted query link using get request (55 ms)
      usage reporting
        graphql server functions even when Apollo servers are down
          âœ• with retryable error (2 ms)
          âœ• with network error (1 ms)
          âœ• with non-retryable error (2 ms)
      Federated tracing
        âœ“ doesn't include federated trace without the special header (55 ms)
        âœ“ doesn't include federated trace without _Service in the schema (85 ms)
        âœ“ reports a total duration that is longer than the duration of its resolvers (138 ms)
        âœ“ includes errors in federated trace (91 ms)
      Response caching
        âœ“ basic caching (310 ms)
      Gateway
        âœ“ receives schema updates from the gateway (with document store: true) (100 ms)
        âœ“ receives schema updates from the gateway (with document store: false) (123 ms)
        âœ“ passes apollo data to the gateway (280 ms)
        âœ“ unsubscribes from schema update on close (74 ms)
        âœ“ waits until gateway has resolved a schema to respond to queries (91 ms)
        âœ“ can serve multiple active schemas simultaneously during a schema rollover (225 ms)
      renderLandingPage
        âœ“ defaults to LocalDefault (56 ms)
        âœ“ can specify version for LocalDefault (62 ms)
        âœ“ can install playground with specific version (183 ms)
        âœ“ can be disabled (52 ms)
        basic functionality
          with non-root graphqlPath
            âœ“ basic GET works (116 ms)
            âœ“ only mounts under graphqlPath (88 ms)
            âœ“ needs the header (116 ms)
            âœ“ trailing slash works (61 ms)
          with root graphqlPath
            âœ“ basic GET works (67 ms)
            âœ“ needs the header (70 ms)
        startup errors
          âœ“ only one plugin can implement renderLandingPage (35 ms)
      CSRF prevention
        âœ“ csrfPrevention: true (279 ms)
        âœ“ csrfPrevention: {requestHeaders} (153 ms)
  non-integration tests
    constructor
      âœ“ accepts typeDefs and resolvers (46 ms)
    applyMiddleware
      âœ“ can be queried (42 ms)
      âœ“ renders landing page by default when browser requests (43 ms)
      âœ“ accepts cors configuration (54 ms)
      âœ“ accepts custom route configuration (41 ms)
      âœ“ passes each request and response toolkit through to the context function (54 ms)
      health checks
        âœ“ creates a health check endpoint (48 ms)
        âœ“ provides a callback for the health check (72 ms)
        âœ“ can disable the healthCheck (59 ms)
      errors
        âœ“ returns thrown context error as a valid graphql result (79 ms)
        âœ“ propagates error codes in dev mode (70 ms)
        âœ“ propagates error codes in production (71 ms)
        âœ“ propagates error codes with null response in production (69 ms)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-hapi â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-hapi â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-hapi â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

PASS packages/apollo-server/src/__tests__/index.test.ts (10.33 s)
  apollo-server
    constructor
      âœ“ accepts typeDefs and resolvers (3 ms)
      âœ“ accepts typeDefs and mocks (1 ms)
      âœ“ runs serverWillStart and serverWillStop (161 ms)
      stops even with open HTTP connections
        âœ“ all connections are idle (50 ms)
        âœ“ a connection with an active HTTP request (235 ms)
      context field
        as a function
          âœ“ can accept and return `req` (35 ms)
          âœ“ can accept nothing and return an empty object (64 ms)
      as an object
        âœ“ can be an empty object (76 ms)
        âœ“ can contain arbitrary values (90 ms)
    without registerServer
      âœ“ can be queried (59 ms)
      âœ“ can use executeOperation (21 ms)
      âœ“ renders landing page when browser requests (104 ms)
      âœ“ configures cors (46 ms)
      âœ“ configures cors (39 ms)
      âœ“ creates a health check endpoint (34 ms)

PASS packages/apollo-server-core/src/plugin/usageReporting/__tests__/traceDetails.test.ts
  check variableJson output for sendVariableValues null or undefined (default)
    âœ“ Case 1: No keys/values in variables to be filtered/not filtered (9 ms)
    âœ“ Case 2: Filter all variables (20 ms)
  check variableJson output for sendVariableValues all/none type
    âœ“ Case 1: No keys/values in variables to be filtered/not filtered (2 ms)
    âœ“ Case 2: Filter all variables (2 ms)
    âœ“ Case 3: Do not filter variables (12 ms)
    âœ“ Case 4: Check behavior for invalid inputs (1 ms)
  variableJson output for sendVariableValues exceptNames: Array type
    âœ“ array contains some values not in keys (1 ms)
    âœ“ none=true equivalent to exceptNames=[all variables] (1 ms)
  variableJson output for sendVariableValues onlyNames: Array type
    âœ“ array contains some values not in keys (1 ms)
    âœ“ all=true equivalent to onlyNames=[all variables]
    âœ“ none=true equivalent to onlyNames=[] (1 ms)
  variableJson output for sendVariableValues transform: custom function type
    âœ“ test custom function that redacts every variable to some value (2 ms)
    âœ“ original keys in variables should match the modified keys (17 ms)
    âœ“ expect empty string for keys removed by the custom modifier (1 ms)
    âœ“ expect stringify(null) for values set to null by custom modifier
    âœ“ redact all variable values when custom modifier throws an error (10 ms)

PASS packages/apollo-server-core/src/__tests__/errors.test.ts
  Errors
    ApolloError
      âœ“ defaults code to INTERNAL_SERVER_ERROR (13 ms)
      âœ“ allows code setting and additional properties (34 ms)
    formatApolloErrors
      âœ“ exposes a stacktrace in debug mode (47 ms)
      âœ“ hides stacktrace by default (6 ms)
      âœ“ exposes fields on error under exception field and provides code (6 ms)
      âœ“ calls formatter after exposing the code and stacktrace (5 ms)
      âœ“ Formats native Errors in a JSON-compatible way (1 ms)
    Named Errors
      âœ“ provides an authentication error (12 ms)
      âœ“ provides a forbidden error (1 ms)
      âœ“ provides a syntax error (2 ms)
      âœ“ provides a validation error (2 ms)
      âœ“ provides a user input error (5 ms)

PASS packages/apollo-server-core/src/plugin/cacheControl/__tests__/dynamicCacheControl.test.ts
  dynamic cache control
    âœ“ should set the maxAge for a field from a dynamic cache hint (105 ms)
    âœ“ can use restrict to set the maxAge for a field (20 ms)
    âœ“ should set the scope for a field from a dynamic cache hint (19 ms)
    âœ“ should override the maxAge set for a field from a dynamic cache hint (11 ms)

PASS packages/apollo-server-koa/src/__tests__/datasource.test.ts (7.452 s)
  apollo-server-koa
    âœ“ uses the cache (245 ms)
    âœ“ can cache a string from the backend (42 ms)

PASS packages/apollo-server-micro/src/__tests__/ApolloServer.test.ts (10.459 s)
  apollo-server-micro
    constructor
      âœ“ should accepts typeDefs and resolvers (162 ms)
    #createHandler
      querying
        âœ“ should be queryable using the default /graphql path, if no path is provided (260 ms)
        âœ“ should only be queryable at the default /graphql path, if no path is provided (66 ms)
        âœ“ should be queryable using a custom path (74 ms)
        âœ“ should render a landing page when a browser sends in a request (111 ms)
      health checks
        âœ“ should create a health check endpoint (53 ms)
        âœ“ should support a health check callback (80 ms)
        âœ“ should be able to disable the health check (44 ms)

PASS packages/apollo-server-core/src/plugin/usageReporting/__tests__/durationHistogram.test.ts
  Duration histogram tests
    âœ“ generateEmptyHistogram (41 ms)
    âœ“ nonEmptyHistogram (3 ms)
    âœ“ testToArray (112 ms)
    âœ“ combineHistogram (1 ms)
    âœ“ bucketZeroToOne (10 ms)
    âœ“ bucketOneToTwo (2 ms)
    âœ“ bucketToThreshold (1 ms)
    âœ“ bucketForCommonTimes (2 ms)
    âœ“ testLastBucket (4 ms)

PASS packages/apollo-server-express/src/__tests__/datasource.test.ts (5.053 s)
  apollo-server-express
    âœ“ uses the cache (244 ms)
    âœ“ can cache a string from the backend (64 ms)

PASS packages/apollo-server-core/src/__tests__/runHttpQuery.test.ts
  runHttpQuery
    handling a GET query
      âœ“ raises a 400 error if the query is missing (162 ms)
    when allowBatchedHttpRequests is false
      âœ“ succeeds when there are no batched queries in the request (63 ms)
      âœ“ throws when there are batched queries in the request (3 ms)
    when allowBatchedHttpRequests is true
      âœ“ succeeds when there are multiple queries in the request (10 ms)

FAIL packages/apollo-server-lambda/src/__tests__/ApolloServer.test.ts (15.432 s)
  apollo-server-lambda
    âœ“ expressAppFromMiddleware (31 ms)
    ApolloServer
      constructor
        validation rules
          âœ“ accepts additional rules (540 ms)
          âœ“ allows introspection by default (37 ms)
          âœ“ prevents introspection by default during production (51 ms)
          âœ“ allows introspection to be enabled explicitly (117 ms)
          âœ“ prohibits providing a gateway in addition to schema/typeDefs/resolvers (6 ms)
        appropriate error for bad user input
          âœ“ variable coercion errors (166 ms)
          âœ“ catches required type variable error and returns UserInputError (49 ms)
          âœ“ catches required List type variable error and returns UserInputError (138 ms)
          âœ“ catches non-null type variable error and returns UserInputError (99 ms)
          âœ“ catches non-null List type variable error and returns UserInputError (41 ms)
          âœ“ catches List of non-null type variable error and returns UserInputError (42 ms)
        schema creation
          âœ“ accepts typeDefs and resolvers (32 ms)
          âœ“ accepts a gateway's schema and calls its executor (32 ms)
          âœ“ uses schema over resolvers + typeDefs (51 ms)
          âœ“ allows mocks as boolean (70 ms)
          âœ“ allows mocks as an object (62 ms)
          âœ“ allows mocks as an object without overriding the existing resolvers (97 ms)
      Plugins
        âœ“ works when using executeOperation (17 ms)
        âœ“ returns correct status code for a normal operation (20 ms)
        âœ“ allows setting a custom status code for an error (35 ms)
        âœ“ preserves user-added "extensions" in the response when parsing errors occur (96 ms)
        âœ“ preserves user-added "extensions" in the response when validation errors occur (47 ms)
      formatError
        âœ“ wraps thrown error from validation rules (78 ms)
        âœ“ works with errors similar to GraphQL errors, such as yup (65 ms)
      lifecycle
        âœ“ errors thrown in plugins call formatError and are wrapped (33 ms)
        âœ“ propagates error codes in production (32 ms)
        âœ“ propagates error codes with null response in production (31 ms)
        âœ“ shows ApolloError extensions in extensions (only!) (35 ms)
        for Apollo usage reporting
          traces
            âœ• cachePolicy (22 ms)
            âœ• does not expose stack (5 ms)
            âœ• sets the trace key to operationName when it is defined (3 ms)
            âœ• sets the trace key to unknown operation for missing operation (3 ms)
            âœ• sets the trace key to parse failure when non-parsable gql (3 ms)
            âœ• sets the trace key to validation failure when invalid operation (11 ms)
            âœ• sets the trace key to "-" when operationName is undefined (3 ms)
            âœ• doesn't resort to query body signature on `didResolveOperation` error (9 ms)
            âœ• doesn't internal server error on an APQ (6 ms)
            error munging
              âœ• undefined error (2 ms)
              rewriteError
                âœ• new error (3 ms)
                âœ• modified error (5 ms)
                âœ• nulled error (9 ms)
        context field
          âœ“ defers context eval with thunk until after options creation (75 ms)
          context cloning
            âœ“ clones the context for request pipeline requests (62 ms)
            âœ“ for every request with executeOperation (37 ms)
          as a function
            âœ“ can accept and return `req` (25 ms)
            âœ“ can accept nothing and return an empty object (32 ms)
            âœ“ can be an async function (24 ms)
            âœ“ returns thrown context error as a valid graphql result (25 ms)
          as an object
            âœ“ can be an empty object (23 ms)
            âœ“ can contain arbitrary values (15 ms)
      Persisted Queries
        âœ“ returns PersistedQueryNotFound on the first try (26 ms)
        âœ“ returns result on the second try (32 ms)
        âœ“ returns result on the persisted query (30 ms)
        âœ“ returns error when hash does not match (21 ms)
        âœ“ returns correct result for persisted query link (53 ms)
        âœ“ returns correct result for persisted query link using get request (50 ms)
      usage reporting
        graphql server functions even when Apollo servers are down
          âœ• with retryable error (2 ms)
          âœ• with network error (2 ms)
          âœ• with non-retryable error (1 ms)
      Federated tracing
        âœ“ doesn't include federated trace without the special header (38 ms)
        âœ“ doesn't include federated trace without _Service in the schema (55 ms)
        âœ“ reports a total duration that is longer than the duration of its resolvers (94 ms)
        âœ“ includes errors in federated trace (55 ms)
      Response caching
        âœ“ basic caching (562 ms)
      Gateway
        âœ“ receives schema updates from the gateway (with document store: true) (93 ms)
        âœ“ receives schema updates from the gateway (with document store: false) (77 ms)
        âœ“ passes apollo data to the gateway (229 ms)
        âœ“ unsubscribes from schema update on close (56 ms)
        âœ“ waits until gateway has resolved a schema to respond to queries (22 ms)
        âœ“ can serve multiple active schemas simultaneously during a schema rollover (75 ms)
      renderLandingPage
        âœ“ defaults to LocalDefault (69 ms)
        âœ“ can specify version for LocalDefault (28 ms)
        âœ“ can install playground with specific version (77 ms)
        âœ“ can be disabled (22 ms)
        basic functionality
          with non-root graphqlPath
            âœ“ basic GET works (25 ms)
            âœ“ only mounts under graphqlPath (40 ms)
            âœ“ needs the header (27 ms)
            âœ“ trailing slash works (30 ms)
          with root graphqlPath
            âœ“ basic GET works (27 ms)
            âœ“ needs the header (18 ms)
      CSRF prevention
        âœ“ csrfPrevention: true (122 ms)
        âœ“ csrfPrevention: {requestHeaders} (86 ms)
    context
      âœ“ context functions typecheck (21 ms)
      âœ“ receives both Express and Lambda context (36 ms)
    health checks
      âœ“ creates a health check endpoint (77 ms)
      âœ“ provides a callback for the health check (49 ms)
      âœ“ returns a 503 if health check fails (52 ms)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-lambda â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-lambda â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-lambda â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

PASS packages/apollo-server-core/src/plugin/cacheControl/__tests__/cacheControlPlugin.test.ts
  plugin
    willSendResponse
      HTTP cache-control header
        âœ“ is set when calculateHttpHeaders is set to true (39 ms)
        âœ“ is not set when calculateHttpHeaders is set to false (4 ms)
        âœ“ is not set if response has errors (5 ms)
        âœ“ does not set cache-control header if there is no overall cache policy (3 ms)

PASS packages/apollo-server-core/src/plugin/schemaReporting/__tests__/schemaReporter.test.ts
  Schema reporter
    âœ“ return correct values if no errors (46 ms)
    âœ“ throws on 500 response (18 ms)
    âœ“ throws on 200 malformed response (15 ms)
    âœ“ sends schema if withCoreSchema is true. (17 ms)

PASS packages/apollo-server-core/src/__tests__/cachePolicy.test.ts
  newCachePolicy
    âœ“ starts uncacheable (11 ms)
    âœ“ restricting maxAge positive makes restricted
    âœ“ restricting maxAge 0 makes restricted
    âœ“ restricting scope to private makes restricted (1 ms)
    âœ“ returns lowest max age value (1 ms)
    âœ“ returns lowest max age value in other order (2 ms)
    âœ“ maxAge 0 if any cache hint has a maxAge of 0 (1 ms)
    âœ“ returns undefined if first cache hint has a maxAge of 0 (1 ms)
    âœ“ only restricting maxAge keeps scope undefined
    âœ“ returns PRIVATE scope if any cache hint has PRIVATE scope (4 ms)
    âœ“ policyIfCacheable (5 ms)
    âœ“ replace (1 ms)

PASS packages/apollo-server-core/src/__tests__/documentStore.test.ts
  ApolloServerBase documentStore
    âœ“ documentStore - undefined (311 ms)
    âœ“ documentStore - custom (43 ms)
    âœ“ documentStore - null (29 ms)
    âœ“ documentStore with changing schema

PASS packages/apollo-server-core/src/__tests__/dataSources.test.ts
  ApolloServerBase dataSources
    âœ“ initializes synchronous datasources from a datasource creator function (307 ms)
    âœ“ initializes all async and sync datasources before calling resolvers (32 ms)
    âœ“ makes datasources available on resolver contexts (39 ms)

PASS packages/apollo-server-errors/src/__tests__/ApolloError.test.ts
  ApolloError
    âœ“ doesn't overwrite extensions when provided in the constructor (10 ms)
    âœ“ a code property doesn't overwrite the code provided to the constructor (2 ms)
    âœ“ a message property doesn't overwrite the message provided to the constructor (1 ms)
    âœ“ throws for users who use an extensions key in the third constructor argument (85 ms)
    âœ“ provides toJSON method (3 ms)
    âœ“ provides toString method (24 ms)
  ForbiddenError
    âœ“ supports arbitrary data being passed (4 ms)
  AuthenticationError
    âœ“ supports arbitrary data being passed (9 ms)

PASS packages/apollo-server-core/src/plugin/schemaReporting/__tests__/index.test.ts
  end-to-end
    âœ“ fails for unparsable overrideReportedSchema (19 ms)
    âœ“ fails for invalid overrideReportedSchema (11 ms)

PASS packages/apollo-server-core/src/__tests__/logger.test.ts
  logger
    âœ“ uses internal loglevel logger by default (204 ms)
    âœ“ uses custom logger when configured (31 ms)

PASS packages/apollo-server-core/src/plugin/schemaReporting/__tests__/computeCoreSchemaHash.test.ts
  Executable Schema Id
    âœ“ does not normalize GraphQL schemas (33 ms)
    âœ“ does not normalize strings (2 ms)

PASS packages/apollo-server-fastify/src/__tests__/datasource.test.ts (13.357 s)
  apollo-server-fastify
    âœ“ uses the cache (462 ms)
    âœ“ can cache a string from the backend (1087 ms)

PASS packages/apollo-server-cache-redis/src/__tests__/BaseRedisCache.test.ts (15.387 s)
  BaseRedisCache
    âœ“ run apollo-server-caching test suite (63 ms)

PASS packages/apollo-server-cloud-functions/src/__tests__/googleCloudApollo.test.ts (35.62 s)
  googleCloudApollo
    âœ“ handles requests with path set to null (594 ms)
  integration:CloudFunction
    apolloServer
      âœ“ calls serverWillStart before serving a request (28 ms)
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (259 ms)
        âœ“ throws an error if POST body is empty (180 ms)
        âœ“ throws an error if POST body is missing even with content-type (292 ms)
        âœ“ throws an error if invalid content-type (175 ms)
        âœ“ throws an error if POST operation is missing (92 ms)
        âœ“ throws an error if POST operation is empty (547 ms)
        âœ“ throws an error if POST JSON is malformed (143 ms)
        âœ“ throws an error if GET query is missing (36 ms)
        âœ“ can handle a basic GET request (149 ms)
        âœ“ can handle a basic implicit GET request (44 ms)
        âœ“ throws error if trying to use mutation using GET request (246 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (247 ms)
        âœ“ can handle a GET request with variables (157 ms)
        âœ“ can handle a basic request (84 ms)
        âœ“ cache-control not set without any hints (48 ms)
        âœ“ cache-control set with dynamic hint (84 ms)
        âœ“ cache-control set with defaultMaxAge (113 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (113 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (34 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (45 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (77 ms)
        âœ“ can handle a request with variables (69 ms)
        âœ“ can handle a request with variables as string (116 ms)
        âœ“ can handle a request with variables as an invalid string (96 ms)
        âœ“ can handle a request with operationName (76 ms)
        âœ“ can handle introspection request (201 ms)
        âœ“ does not accept a query AST (75 ms)
        âœ“ can handle batch requests (43 ms)
        âœ“ can handle batch requests (76 ms)
        âœ“ can handle batch requests in parallel (454 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (232 ms)
        âœ“ clones batch context (81 ms)
        âœ“ executes batch context if it is a function (177 ms)
        âœ“ can handle a request with a mutation (58 ms)
        âœ“ applies the formatResponse function (63 ms)
        âœ“ passes the context to the resolver (38 ms)
        âœ“ passes the rootValue to the resolver (97 ms)
        âœ“ passes the rootValue function result to the resolver (34 ms)
        âœ“ returns errors (379 ms)
        âœ“ applies formatError if provided (190 ms)
        âœ“ formatError receives error that passes instanceof checks (254 ms)
        âœ“ allows for custom error formatting to sanitize (78 ms)
        âœ“ allows for custom error formatting to elaborate (25 ms)
        âœ“ sends internal server error when formatError fails (68 ms)
        âœ“ applies additional validationRules (144 ms)
        cors enabled by default
          âœ“ for POST request (56 ms)
          âœ“ for OPTIONS preflight request (44 ms)
      status code
        âœ“ allows setting a custom status code (21 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (44 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (60 ms)
        âœ“ errors when version is not specified (173 ms)
        âœ“ errors when version is unsupported (32 ms)
        âœ“ errors when hash is mismatched (306 ms)
        âœ“ returns PersistedQueryNotFound on the first try (83 ms)
        âœ“ returns result on the second try (56 ms)
        âœ“ returns with batched persisted queries (313 ms)
        âœ“ returns result on the persisted query (1031 ms)
        âœ“ returns error when hash does not match (1751 ms)
        âœ“ returns correct result using get request (2610 ms)

PASS packages/apollo-server-fastify/src/__tests__/fastifyApollo.test.ts (38.96 s)
  fastifyApollo
    âœ“ throws error if called without schema (334 ms)
  integration:Fastify
    apolloServer
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (2450 ms)
        âœ“ throws an error if POST body is empty (1177 ms)
        âœ“ throws an error if POST body is missing even with content-type (1073 ms)
        âœ“ throws an error if invalid content-type (339 ms)
        âœ“ throws an error if POST operation is missing (151 ms)
        âœ“ throws an error if POST operation is empty (249 ms)
        âœ“ throws an error if POST JSON is malformed (274 ms)
        âœ“ throws an error if GET query is missing (145 ms)
        âœ“ can handle a basic GET request (148 ms)
        âœ“ can handle a basic implicit GET request (135 ms)
        âœ“ throws error if trying to use mutation using GET request (351 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (293 ms)
        âœ“ can handle a GET request with variables (227 ms)
        âœ“ can handle a basic request (191 ms)
        âœ“ cache-control not set without any hints (159 ms)
        âœ“ cache-control set with dynamic hint (199 ms)
        âœ“ cache-control set with defaultMaxAge (181 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (157 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (192 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (298 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (206 ms)
        âœ“ can handle a request with variables (186 ms)
        âœ“ can handle a request with variables as string (139 ms)
        âœ“ can handle a request with variables as an invalid string (68 ms)
        âœ“ can handle a request with operationName (110 ms)
        âœ“ can handle introspection request (230 ms)
        âœ“ does not accept a query AST (136 ms)
        âœ“ can handle batch requests (189 ms)
        âœ“ can handle batch requests (167 ms)
        âœ“ can handle batch requests in parallel (390 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (207 ms)
        âœ“ clones batch context (111 ms)
        âœ“ executes batch context if it is a function (78 ms)
        âœ“ can handle a request with a mutation (94 ms)
        âœ“ applies the formatResponse function (196 ms)
        âœ“ passes the context to the resolver (232 ms)
        âœ“ passes the rootValue to the resolver (109 ms)
        âœ“ passes the rootValue function result to the resolver (252 ms)
        âœ“ returns errors (590 ms)
        âœ“ applies formatError if provided (185 ms)
        âœ“ formatError receives error that passes instanceof checks (230 ms)
        âœ“ allows for custom error formatting to sanitize (254 ms)
        âœ“ allows for custom error formatting to elaborate (122 ms)
        âœ“ sends internal server error when formatError fails (65 ms)
        âœ“ applies additional validationRules (246 ms)
        cors enabled by default
          âœ“ for POST request (186 ms)
          âœ“ for OPTIONS preflight request (127 ms)
      server setup
        âœ“ throws error on 404 routes (127 ms)
      status code
        âœ“ allows setting a custom status code (215 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (135 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (388 ms)
        âœ“ errors when version is not specified (744 ms)
        âœ“ errors when version is unsupported (1384 ms)
        âœ“ errors when hash is mismatched (1760 ms)
        âœ“ returns PersistedQueryNotFound on the first try (3258 ms)
        âœ“ returns result on the second try (1588 ms)
        âœ“ returns with batched persisted queries (692 ms)
        âœ“ returns result on the persisted query (359 ms)
        âœ“ returns error when hash does not match (136 ms)
        âœ“ returns correct result using get request (347 ms)

FAIL packages/apollo-server-koa/src/__tests__/koaApollo.test.ts (41.431 s)
  koaApollo
    âœ“ throws error if called without schema (584 ms)
  integration:Koa
    apolloServer
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (1703 ms)
        âœ“ throws an error if POST body is empty (743 ms)
        âœ“ throws an error if POST body is missing even with content-type (657 ms)
        âœ“ throws an error if invalid content-type (296 ms)
        âœ“ throws an error if POST operation is missing (237 ms)
        âœ“ throws an error if POST operation is empty (1317 ms)
        âœ“ throws an error if POST JSON is malformed (800 ms)
        âœ“ throws an error if GET query is missing (202 ms)
        âœ“ can handle a basic GET request (118 ms)
        âœ“ can handle a basic implicit GET request (53 ms)
        âœ“ throws error if trying to use mutation using GET request (188 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (74 ms)
        âœ“ can handle a GET request with variables (44 ms)
        âœ“ can handle a basic request (118 ms)
        âœ“ cache-control not set without any hints (53 ms)
        âœ“ cache-control set with dynamic hint (32 ms)
        âœ“ cache-control set with defaultMaxAge (109 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (164 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (414 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (1260 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (2458 ms)
        âœ“ can handle a request with variables (76 ms)
        âœ“ can handle a request with variables as string (95 ms)
        âœ“ can handle a request with variables as an invalid string (49 ms)
        âœ“ can handle a request with operationName (52 ms)
        âœ“ can handle introspection request (130 ms)
        âœ“ does not accept a query AST (99 ms)
        âœ“ can handle batch requests (74 ms)
        âœ“ can handle batch requests (37 ms)
        âœ“ can handle batch requests in parallel (495 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (88 ms)
        âœ“ clones batch context (35 ms)
        âœ“ executes batch context if it is a function (36 ms)
        âœ“ can handle a request with a mutation (20 ms)
        âœ“ applies the formatResponse function (28 ms)
        âœ“ passes the context to the resolver (25 ms)
        âœ“ passes the rootValue to the resolver (44 ms)
        âœ“ passes the rootValue function result to the resolver (79 ms)
        âœ“ returns errors (164 ms)
        âœ“ applies formatError if provided (60 ms)
        âœ“ formatError receives error that passes instanceof checks (49 ms)
        âœ“ allows for custom error formatting to sanitize (31 ms)
        âœ“ allows for custom error formatting to elaborate (33 ms)
        âœ“ sends internal server error when formatError fails (43 ms)
        âœ“ applies additional validationRules (71 ms)
        cors enabled by default
          âœ• for POST request (6220 ms)
          âœ“ for OPTIONS preflight request (127 ms)
      server setup
        âœ“ throws error on 404 routes (28 ms)
      status code
        âœ“ allows setting a custom status code (22 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (30 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (35 ms)
        âœ“ errors when version is not specified (50 ms)
        âœ“ errors when version is unsupported (29 ms)
        âœ“ errors when hash is mismatched (35 ms)
        âœ“ returns PersistedQueryNotFound on the first try (84 ms)
        âœ“ returns result on the second try (81 ms)
        âœ“ returns with batched persisted queries (32 ms)
        âœ“ returns result on the persisted query (38 ms)
        âœ“ returns error when hash does not match (20 ms)
        âœ“ returns correct result using get request (28 ms)

  â— integration:Koa â€º apolloServer â€º graphqlHTTP â€º cors enabled by default â€º for POST request

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      653 |         describe('cors enabled by default', () => {
      654 |           const origin = 'https://my-origin.test/';
    > 655 |           it('for POST request', async () => {
          |           ^
      656 |             app = await createApp();
      657 |             const expected = {
      658 |               testString: 'it works',

      at ../apollo-server-integration-testsuite/src/index.ts:655:11
      at ../apollo-server-integration-testsuite/src/index.ts:653:9
      at ../apollo-server-integration-testsuite/src/index.ts:247:5
      at Object.<anonymous>.exports.default (../apollo-server-integration-testsuite/src/index.ts:229:3)

PASS packages/apollo-server-express/src/__tests__/expressApollo.test.ts (10.283 s)
  expressApollo
    âœ“ throws error if called without schema (149 ms)
  integration:Express
    apolloServer
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (189 ms)
        âœ“ throws an error if POST body is empty (85 ms)
        âœ“ throws an error if POST body is missing even with content-type (173 ms)
        âœ“ throws an error if invalid content-type (104 ms)
        âœ“ throws an error if POST operation is missing (74 ms)
        âœ“ throws an error if POST operation is empty (118 ms)
        âœ“ throws an error if POST JSON is malformed (78 ms)
        âœ“ throws an error if GET query is missing (47 ms)
        âœ“ can handle a basic GET request (142 ms)
        âœ“ can handle a basic implicit GET request (29 ms)
        âœ“ throws error if trying to use mutation using GET request (56 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (160 ms)
        âœ“ can handle a GET request with variables (170 ms)
        âœ“ can handle a basic request (85 ms)
        âœ“ cache-control not set without any hints (39 ms)
        âœ“ cache-control set with dynamic hint (60 ms)
        âœ“ cache-control set with defaultMaxAge (60 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (84 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (42 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (41 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (79 ms)
        âœ“ can handle a request with variables (52 ms)
        âœ“ can handle a request with variables as string (60 ms)
        âœ“ can handle a request with variables as an invalid string (82 ms)
        âœ“ can handle a request with operationName (72 ms)
        âœ“ can handle introspection request (140 ms)
        âœ“ does not accept a query AST (44 ms)
        âœ“ can handle batch requests (45 ms)
        âœ“ can handle batch requests (32 ms)
        âœ“ can handle batch requests in parallel (388 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (45 ms)
        âœ“ clones batch context (64 ms)
        âœ“ executes batch context if it is a function (57 ms)
        âœ“ can handle a request with a mutation (44 ms)
        âœ“ applies the formatResponse function (40 ms)
        âœ“ passes the context to the resolver (36 ms)
        âœ“ passes the rootValue to the resolver (64 ms)
        âœ“ passes the rootValue function result to the resolver (81 ms)
        âœ“ returns errors (253 ms)
        âœ“ applies formatError if provided (42 ms)
        âœ“ formatError receives error that passes instanceof checks (53 ms)
        âœ“ allows for custom error formatting to sanitize (44 ms)
        âœ“ allows for custom error formatting to elaborate (70 ms)
        âœ“ sends internal server error when formatError fails (69 ms)
        âœ“ applies additional validationRules (75 ms)
        cors enabled by default
          âœ“ for POST request (50 ms)
          âœ“ for OPTIONS preflight request (46 ms)
      server setup
        âœ“ throws error on 404 routes (72 ms)
      status code
        âœ“ allows setting a custom status code (84 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (102 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (99 ms)
        âœ“ errors when version is not specified (93 ms)
        âœ“ errors when version is unsupported (36 ms)
        âœ“ errors when hash is mismatched (61 ms)
        âœ“ returns PersistedQueryNotFound on the first try (48 ms)
        âœ“ returns result on the second try (36 ms)
        âœ“ returns with batched persisted queries (54 ms)
        âœ“ returns result on the persisted query (32 ms)
        âœ“ returns error when hash does not match (18 ms)
        âœ“ returns correct result using get request (43 ms)

PASS packages/apollo-server-lambda/src/__tests__/lambdaApollo.test.ts (37.422 s)
  integration:APIGateway:Lambda
    apolloServer
      âœ“ calls serverWillStart before serving a request (28 ms)
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (1269 ms)
        âœ“ throws an error if POST body is empty (1075 ms)
        âœ“ throws an error if POST body is missing even with content-type (1361 ms)
        âœ“ throws an error if invalid content-type (1144 ms)
        âœ“ throws an error if POST operation is missing (750 ms)
        âœ“ throws an error if POST operation is empty (367 ms)
        âœ“ throws an error if POST JSON is malformed (70 ms)
        âœ“ throws an error if GET query is missing (73 ms)
        âœ“ can handle a basic GET request (59 ms)
        âœ“ can handle a basic implicit GET request (44 ms)
        âœ“ throws error if trying to use mutation using GET request (85 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (50 ms)
        âœ“ can handle a GET request with variables (57 ms)
        âœ“ can handle a basic request (45 ms)
        âœ“ cache-control not set without any hints (31 ms)
        âœ“ cache-control set with dynamic hint (45 ms)
        âœ“ cache-control set with defaultMaxAge (64 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (63 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (24 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (64 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (76 ms)
        âœ“ can handle a request with variables (31 ms)
        âœ“ can handle a request with variables as string (37 ms)
        âœ“ can handle a request with variables as an invalid string (85 ms)
        âœ“ can handle a request with operationName (72 ms)
        âœ“ can handle introspection request (181 ms)
        âœ“ does not accept a query AST (61 ms)
        âœ“ can handle batch requests (42 ms)
        âœ“ can handle batch requests (85 ms)
        âœ“ can handle batch requests in parallel (304 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (60 ms)
        âœ“ clones batch context (74 ms)
        âœ“ executes batch context if it is a function (66 ms)
        âœ“ can handle a request with a mutation (127 ms)
        âœ“ applies the formatResponse function (30 ms)
        âœ“ passes the context to the resolver (98 ms)
        âœ“ passes the rootValue to the resolver (54 ms)
        âœ“ passes the rootValue function result to the resolver (46 ms)
        âœ“ returns errors (66 ms)
        âœ“ applies formatError if provided (34 ms)
        âœ“ formatError receives error that passes instanceof checks (27 ms)
        âœ“ allows for custom error formatting to sanitize (68 ms)
        âœ“ allows for custom error formatting to elaborate (61 ms)
        âœ“ sends internal server error when formatError fails (31 ms)
        âœ“ applies additional validationRules (26 ms)
        cors enabled by default
          âœ“ for POST request (56 ms)
          âœ“ for OPTIONS preflight request (35 ms)
      status code
        âœ“ allows setting a custom status code (24 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (28 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (24 ms)
        âœ“ errors when version is not specified (66 ms)
        âœ“ errors when version is unsupported (28 ms)
        âœ“ errors when hash is mismatched (55 ms)
        âœ“ returns PersistedQueryNotFound on the first try (73 ms)
        âœ“ returns result on the second try (79 ms)
        âœ“ returns with batched persisted queries (51 ms)
        âœ“ returns result on the persisted query (91 ms)
        âœ“ returns error when hash does not match (35 ms)
        âœ“ returns correct result using get request (40 ms)
  integration:ALB:Lambda
    apolloServer
      âœ“ calls serverWillStart before serving a request (26 ms)
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (37 ms)
        âœ“ throws an error if POST body is empty (33 ms)
        âœ“ throws an error if POST body is missing even with content-type (21 ms)
        âœ“ throws an error if invalid content-type (24 ms)
        âœ“ throws an error if POST operation is missing (46 ms)
        âœ“ throws an error if POST operation is empty (27 ms)
        âœ“ throws an error if POST JSON is malformed (19 ms)
        âœ“ throws an error if GET query is missing (27 ms)
        âœ“ can handle a basic GET request (29 ms)
        âœ“ can handle a basic implicit GET request (46 ms)
        âœ“ throws error if trying to use mutation using GET request (66 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (50 ms)
        âœ“ can handle a GET request with variables (28 ms)
        âœ“ can handle a basic request (33 ms)
        âœ“ cache-control not set without any hints (52 ms)
        âœ“ cache-control set with dynamic hint (90 ms)
        âœ“ cache-control set with defaultMaxAge (49 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (32 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (39 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (36 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (52 ms)
        âœ“ can handle a request with variables (51 ms)
        âœ“ can handle a request with variables as string (34 ms)
        âœ“ can handle a request with variables as an invalid string (67 ms)
        âœ“ can handle a request with operationName (25 ms)
        âœ“ can handle introspection request (61 ms)
        âœ“ does not accept a query AST (38 ms)
        âœ“ can handle batch requests (33 ms)
        âœ“ can handle batch requests (20 ms)
        âœ“ can handle batch requests in parallel (365 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (86 ms)
        âœ“ clones batch context (38 ms)
        âœ“ executes batch context if it is a function (23 ms)
        âœ“ can handle a request with a mutation (58 ms)
        âœ“ applies the formatResponse function (52 ms)
        âœ“ passes the context to the resolver (24 ms)
        âœ“ passes the rootValue to the resolver (20 ms)
        âœ“ passes the rootValue function result to the resolver (38 ms)
        âœ“ returns errors (25 ms)
        âœ“ applies formatError if provided (94 ms)
        âœ“ formatError receives error that passes instanceof checks (73 ms)
        âœ“ allows for custom error formatting to sanitize (28 ms)
        âœ“ allows for custom error formatting to elaborate (31 ms)
        âœ“ sends internal server error when formatError fails (25 ms)
        âœ“ applies additional validationRules (27 ms)
        cors enabled by default
          âœ“ for POST request (86 ms)
          âœ“ for OPTIONS preflight request (68 ms)
      status code
        âœ“ allows setting a custom status code (41 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (35 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (40 ms)
        âœ“ errors when version is not specified (38 ms)
        âœ“ errors when version is unsupported (23 ms)
        âœ“ errors when hash is mismatched (26 ms)
        âœ“ returns PersistedQueryNotFound on the first try (41 ms)
        âœ“ returns result on the second try (48 ms)
        âœ“ returns with batched persisted queries (52 ms)
        âœ“ returns result on the persisted query (65 ms)
        âœ“ returns error when hash does not match (31 ms)
        âœ“ returns correct result using get request (35 ms)

PASS packages/apollo-server-express/src/__tests__/connectApollo.test.ts (36.421 s)
  integration:Connect
    apolloServer
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (1002 ms)
        âœ“ throws an error if POST body is empty (883 ms)
        âœ“ throws an error if POST body is missing even with content-type (2046 ms)
        âœ“ throws an error if invalid content-type (699 ms)
        âœ“ throws an error if POST operation is missing (1184 ms)
        âœ“ throws an error if POST operation is empty (501 ms)
        âœ“ throws an error if POST JSON is malformed (55 ms)
        âœ“ throws an error if GET query is missing (25 ms)
        âœ“ can handle a basic GET request (53 ms)
        âœ“ can handle a basic implicit GET request (35 ms)
        âœ“ throws error if trying to use mutation using GET request (85 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (39 ms)
        âœ“ can handle a GET request with variables (37 ms)
        âœ“ can handle a basic request (43 ms)
        âœ“ cache-control not set without any hints (29 ms)
        âœ“ cache-control set with dynamic hint (30 ms)
        âœ“ cache-control set with defaultMaxAge (54 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (22 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (25 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (36 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (29 ms)
        âœ“ can handle a request with variables (30 ms)
        âœ“ can handle a request with variables as string (28 ms)
        âœ“ can handle a request with variables as an invalid string (32 ms)
        âœ“ can handle a request with operationName (46 ms)
        âœ“ can handle introspection request (112 ms)
        âœ“ does not accept a query AST (72 ms)
        âœ“ can handle batch requests (31 ms)
        âœ“ can handle batch requests (34 ms)
        âœ“ can handle batch requests in parallel (272 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (31 ms)
        âœ“ clones batch context (45 ms)
        âœ“ executes batch context if it is a function (21 ms)
        âœ“ can handle a request with a mutation (32 ms)
        âœ“ applies the formatResponse function (47 ms)
        âœ“ passes the context to the resolver (48 ms)
        âœ“ passes the rootValue to the resolver (57 ms)
        âœ“ passes the rootValue function result to the resolver (42 ms)
        âœ“ returns errors (107 ms)
        âœ“ applies formatError if provided (42 ms)
        âœ“ formatError receives error that passes instanceof checks (58 ms)
        âœ“ allows for custom error formatting to sanitize (34 ms)
        âœ“ allows for custom error formatting to elaborate (24 ms)
        âœ“ sends internal server error when formatError fails (19 ms)
        âœ“ applies additional validationRules (24 ms)
        cors enabled by default
          âœ“ for POST request (21 ms)
          âœ“ for OPTIONS preflight request (51 ms)
      server setup
        âœ“ throws error on 404 routes (20 ms)
      status code
        âœ“ allows setting a custom status code (21 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (24 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (20 ms)
        âœ“ errors when version is not specified (60 ms)
        âœ“ errors when version is unsupported (24 ms)
        âœ“ errors when hash is mismatched (21 ms)
        âœ“ returns PersistedQueryNotFound on the first try (42 ms)
        âœ“ returns result on the second try (41 ms)
        âœ“ returns with batched persisted queries (37 ms)
        âœ“ returns result on the persisted query (34 ms)
        âœ“ returns error when hash does not match (36 ms)
        âœ“ returns correct result using get request (24 ms)

PASS packages/apollo-server-core/src/__tests__/rollupCommonJs.test.ts (7.461 s)
  @rollup/plugin-commonjs
    âœ“ bundles into es6 without circular dependencies issues (6066 ms)

PASS packages/apollo-server-micro/src/__tests__/microApollo.test.ts (9.045 s)
  microApollo
    âœ“ should throw an error if called without a schema (225 ms)
  integration:Micro
    apolloServer
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (210 ms)
        âœ“ throws an error if POST body is empty (58 ms)
        âœ“ throws an error if POST body is missing even with content-type (209 ms)
        âœ“ throws an error if invalid content-type (97 ms)
        âœ“ throws an error if POST operation is missing (94 ms)
        âœ“ throws an error if POST operation is empty (232 ms)
        âœ“ throws an error if POST JSON is malformed (102 ms)
        âœ“ throws an error if GET query is missing (33 ms)
        âœ“ can handle a basic GET request (57 ms)
        âœ“ can handle a basic implicit GET request (92 ms)
        âœ“ throws error if trying to use mutation using GET request (113 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (37 ms)
        âœ“ can handle a GET request with variables (41 ms)
        âœ“ can handle a basic request (27 ms)
        âœ“ cache-control not set without any hints (32 ms)
        âœ“ cache-control set with dynamic hint (31 ms)
        âœ“ cache-control set with defaultMaxAge (66 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (25 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (24 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (44 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (63 ms)
        âœ“ can handle a request with variables (25 ms)
        âœ“ can handle a request with variables as string (44 ms)
        âœ“ can handle a request with variables as an invalid string (30 ms)
        âœ“ can handle a request with operationName (45 ms)
        âœ“ can handle introspection request (67 ms)
        âœ“ does not accept a query AST (39 ms)
        âœ“ can handle batch requests (26 ms)
        âœ“ can handle batch requests (42 ms)
        âœ“ can handle batch requests in parallel (338 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (28 ms)
        âœ“ clones batch context (33 ms)
        âœ“ executes batch context if it is a function (56 ms)
        âœ“ can handle a request with a mutation (74 ms)
        âœ“ applies the formatResponse function (61 ms)
        âœ“ passes the context to the resolver (54 ms)
        âœ“ passes the rootValue to the resolver (55 ms)
        âœ“ passes the rootValue function result to the resolver (33 ms)
        âœ“ returns errors (118 ms)
        âœ“ applies formatError if provided (60 ms)
        âœ“ formatError receives error that passes instanceof checks (53 ms)
        âœ“ allows for custom error formatting to sanitize (78 ms)
        âœ“ allows for custom error formatting to elaborate (41 ms)
        âœ“ sends internal server error when formatError fails (30 ms)
        âœ“ applies additional validationRules (46 ms)
      server setup
        âœ“ throws error on 404 routes (39 ms)
      status code
        âœ“ allows setting a custom status code (27 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (38 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (30 ms)
        âœ“ errors when version is not specified (27 ms)
        âœ“ errors when version is unsupported (29 ms)
        âœ“ errors when hash is mismatched (38 ms)
        âœ“ returns PersistedQueryNotFound on the first try (43 ms)
        âœ“ returns result on the second try (35 ms)
        âœ“ returns with batched persisted queries (32 ms)
        âœ“ returns result on the persisted query (84 ms)
        âœ“ returns error when hash does not match (26 ms)
        âœ“ returns correct result using get request (45 ms)

PASS packages/apollo-server-cache-memcached/src/__tests__/Memcached.test.ts
  Memcached
    âœ“ run apollo-server-caching test suite (30 ms)

PASS packages/apollo-server-caching/src/__tests__/PrefixingKeyValueCache.test.ts
  PrefixingKeyValueCache
    âœ“ prefixes (34 ms)

PASS packages/apollo-server-cache-redis/src/__tests__/RedisClusterCache.test.ts (5.106 s)
  Redis
    âœ“ run apollo-server-caching test suite (26 ms)

PASS packages/apollo-server-hapi/src/__tests__/hapiApollo.test.ts (20.767 s)
  integration:Hapi
    apolloServer
      graphqlHTTP
        âœ“ rejects the request if the method is not POST or GET (1320 ms)
        âœ“ throws an error if POST body is empty (87 ms)
        âœ“ throws an error if POST body is missing even with content-type (120 ms)
        âœ“ throws an error if invalid content-type (120 ms)
        âœ“ throws an error if POST operation is missing (97 ms)
        âœ“ throws an error if POST operation is empty (342 ms)
        âœ“ throws an error if POST JSON is malformed (175 ms)
        âœ“ throws an error if GET query is missing (62 ms)
        âœ“ can handle a basic GET request (130 ms)
        âœ“ can handle a basic implicit GET request (151 ms)
        âœ“ throws error if trying to use mutation using GET request (175 ms)
        âœ“ throws error if trying to use mutation with fragment using GET request (174 ms)
        âœ“ can handle a GET request with variables (278 ms)
        âœ“ can handle a basic request (84 ms)
        âœ“ cache-control not set without any hints (186 ms)
        âœ“ cache-control set with dynamic hint (103 ms)
        âœ“ cache-control set with defaultMaxAge (217 ms)
        âœ“ returns PersistedQueryNotSupported to a GET request if PQs disabled (86 ms)
        âœ“ returns PersistedQueryNotSupported to a POST request if PQs disabled (99 ms)
        âœ“ returns PersistedQueryNotFound to a GET request (167 ms)
        âœ“ returns PersistedQueryNotFound to a POST request (58 ms)
        âœ“ can handle a request with variables (88 ms)
        âœ“ can handle a request with variables as string (154 ms)
        âœ“ can handle a request with variables as an invalid string (100 ms)
        âœ“ can handle a request with operationName (203 ms)
        âœ“ can handle introspection request (251 ms)
        âœ“ does not accept a query AST (112 ms)
        âœ“ can handle batch requests (72 ms)
        âœ“ can handle batch requests (60 ms)
        âœ“ can handle batch requests in parallel (431 ms)
        âœ“ disables batch requests when allowBatchedHttpRequests is false (228 ms)
        âœ“ clones batch context (136 ms)
        âœ“ executes batch context if it is a function (97 ms)
        âœ“ can handle a request with a mutation (74 ms)
        âœ“ applies the formatResponse function (63 ms)
        âœ“ passes the context to the resolver (84 ms)
        âœ“ passes the rootValue to the resolver (142 ms)
        âœ“ passes the rootValue function result to the resolver (97 ms)
        âœ“ returns errors (194 ms)
        âœ“ applies formatError if provided (84 ms)
        âœ“ formatError receives error that passes instanceof checks (163 ms)
        âœ“ allows for custom error formatting to sanitize (74 ms)
        âœ“ allows for custom error formatting to elaborate (82 ms)
        âœ“ sends internal server error when formatError fails (47 ms)
        âœ“ applies additional validationRules (111 ms)
        cors enabled by default
          âœ“ for POST request (72 ms)
          âœ“ for OPTIONS preflight request (73 ms)
      server setup
        âœ“ throws error on 404 routes (66 ms)
      status code
        âœ“ allows setting a custom status code (88 ms)
      Persisted Queries
        âœ“ when ttlSeconds is set, passes ttl to the apq cache set call (79 ms)
        âœ“ when ttlSeconds is unset, ttl is not passed to apq cache (97 ms)
        âœ“ errors when version is not specified (91 ms)
        âœ“ errors when version is unsupported (62 ms)
        âœ“ errors when hash is mismatched (58 ms)
        âœ“ returns PersistedQueryNotFound on the first try (75 ms)
        âœ“ returns result on the second try (158 ms)
        âœ“ returns with batched persisted queries (131 ms)
        âœ“ returns result on the persisted query (133 ms)
        âœ“ returns error when hash does not match (76 ms)
        âœ“ returns correct result using get request (175 ms)

PASS packages/apollo-server-caching/src/__tests__/InMemoryLRUCache.test.ts
  InMemoryLRUCache
    âœ“ run apollo-server-caching test suite (27 ms)

PASS packages/apollo-server-cache-redis/src/__tests__/RedisCache.test.ts
  Redis
    âœ“ run apollo-server-caching test suite (39 ms)

PASS packages/apollo-server-core/src/plugin/usageReporting/__tests__/operationDerivedDataCache.test.ts
  operation-derived data cache key
    âœ“ generates without the operationName (25 ms)
    âœ“ generates with the operationName (4 ms)

PASS packages/apollo-server-plugin-response-cache/src/__tests__/ApolloServerPluginResponseCache.test.ts (9.157 s)
  Response cache plugin
    âœ“ will instantiate when not called with options (59 ms)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Summary of all failing tests
FAIL packages/apollo-server-koa/src/__tests__/ApolloServer.test.ts (15.836 s)
  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-koa â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-koa â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-koa â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-koa â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

FAIL packages/apollo-server-express/src/__tests__/ApolloServer.test.ts (17.537 s)
  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-express â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-express â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-express â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-express â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

FAIL packages/apollo-server-fastify/src/__tests__/ApolloServer.test.ts (23.218 s)
  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-fastify â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-fastify â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-fastify â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-fastify â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

FAIL packages/apollo-server-hapi/src/__tests__/ApolloServer.test.ts (17.404 s)
  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-hapi â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-hapi â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-hapi â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-hapi â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

FAIL packages/apollo-server-lambda/src/__tests__/ApolloServer.test.ts (15.432 s)
  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º cachePolicy

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1063:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º does not expose stack

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1090:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to operationName when it is defined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1123:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to unknown operation for missing operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1142:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to parse failure when non-parsable gql

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1158:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to validation failure when invalid operation

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1173:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º sets the trace key to "-" when operationName is undefined

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1188:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't resort to query body signature on `didResolveOperation` error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1205:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º doesn't internal server error on an APQ

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1234:19)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º new error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1278:23)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º modified error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1321:23)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º rewriteError â€º nulled error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1366:23)

  â— apollo-server-lambda â€º ApolloServer â€º lifecycle â€º for Apollo usage reporting â€º traces â€º error munging â€º undefined error

    The family was unexpectedly 4.

      983 |
      984 |             if (family !== 'IPv4') {
    > 985 |               throw new Error(`The family was unexpectedly ${family}.`);
          |                     ^
      986 |             }
      987 |             return new URL(`http://${address}:${port}`).toString();
      988 |           }

      at MockReportIngress.getUrl (../apollo-server-integration-testsuite/src/ApolloServer.ts:985:21)
      at setupApolloServerAndFetchPair (../apollo-server-integration-testsuite/src/ApolloServer.ts:1046:46)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:1403:21)

  â— apollo-server-lambda â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2072:11)

  â— apollo-server-lambda â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with network error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2075:11)

  â— apollo-server-lambda â€º ApolloServer â€º usage reporting â€º graphql server functions even when Apollo servers are down â€º with non-retryable error

    The family was unexpectedly 4.

      1959 |           fakeUsageReportingServer.address() as AddressInfo;
      1960 |         if (family !== 'IPv4') {
    > 1961 |           throw new Error(`The family was unexpectedly ${family}.`);
           |                 ^
      1962 |         }
      1963 |
      1964 |         const fakeUsageReportingUrl = `http://${address}:${port}`;

      at makeFakeUsageReportingServer (../apollo-server-integration-testsuite/src/ApolloServer.ts:1961:17)
      at testWithStatus (../apollo-server-integration-testsuite/src/ApolloServer.ts:1985:13)
      at Object.<anonymous> (../apollo-server-integration-testsuite/src/ApolloServer.ts:2078:11)

FAIL packages/apollo-server-koa/src/__tests__/koaApollo.test.ts (41.431 s)
  â— integration:Koa â€º apolloServer â€º graphqlHTTP â€º cors enabled by default â€º for POST request

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      653 |         describe('cors enabled by default', () => {
      654 |           const origin = 'https://my-origin.test/';
    > 655 |           it('for POST request', async () => {
          |           ^
      656 |             app = await createApp();
      657 |             const expected = {
      658 |               testString: 'it works',

      at ../apollo-server-integration-testsuite/src/index.ts:655:11
      at ../apollo-server-integration-testsuite/src/index.ts:653:9
      at ../apollo-server-integration-testsuite/src/index.ts:247:5
      at Object.<anonymous>.exports.default (../apollo-server-integration-testsuite/src/index.ts:229:3)


Test Suites: 6 failed, 44 passed, 50 total
Tests:       81 failed, 1311 passed, 1392 total
Snapshots:   21 passed, 21 total
Time:        192.024 s
Ran all test suites in 16 projects.
npm notice 
npm notice New minor version of npm available! 8.11.0 -> 8.12.1
npm notice Changelog: <https://github.com/npm/cli/releases/tag/v8.12.1>
npm notice Run `npm install -g npm@8.12.1` to update!
npm notice 
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy)
[Pipeline] echo
Deploying apollo-server
[Pipeline] sh
+ docker rm -f apollo-server-deploy
Error: No such container: apollo-server-deploy
[Pipeline] sh
+ docker run --name apollo-server-deploy --mount type=volume,src=output-volume,dst=/usr/local/myapp apollo-server bash -c cd /usr/local/myapp/apollo-server && npm run compile:clean

> compile:clean
> tsc --build tsconfig.build.json --clean

npm notice 
npm notice New minor version of npm available! 8.11.0 -> 8.12.1
npm notice Changelog: <https://github.com/npm/cli/releases/tag/v8.12.1>
npm notice Run `npm install -g npm@8.12.1` to update!
npm notice 
[Pipeline] sh
+ sleep 5
+ docker inspect apollo-server-deploy --format={{.State.ExitCode}}
+ exit 0
[Pipeline] sh
+ docker rm -f apollo-server-deploy
apollo-server-deploy
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Prepare publish)
[Pipeline] echo
Preparing publish
[Pipeline] sh
+ ls /var/jenkins_home/workspace/artifacts
apollo-server-monorepo-1.0.0.tgz
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Publish)
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/Projekt@2
[Pipeline] {
[Pipeline] checkout
The recommended git tool is: git
No credentials specified
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/Projekt@2/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/InzynieriaOprogramowaniaAGH/MDO2022_S # timeout=10
Fetching upstream changes from https://github.com/InzynieriaOprogramowaniaAGH/MDO2022_S
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
 > git fetch --tags --force --progress -- https://github.com/InzynieriaOprogramowaniaAGH/MDO2022_S +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/BT403177^{commit} # timeout=10
Checking out Revision dfa45c6672ffc95dfa5142eb3a33c40c43f27ca5 (refs/remotes/origin/BT403177)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f dfa45c6672ffc95dfa5142eb3a33c40c43f27ca5 # timeout=10
Commit message: "BT403177"
[Pipeline] withEnv
[Pipeline] {
[Pipeline] isUnix
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ docker inspect -f . node:alpine
.
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] withDockerContainer
Jenkins seems to be running inside container 9faccc53c7cc58d7865d70a98390602895d1aba3593eaaad5f7e38bab3a0fb50
but /var/jenkins_home/workspace/Projekt@2 could not be found among []
but /var/jenkins_home/workspace/Projekt@2@tmp could not be found among []
$ docker run -t -d -u 1000:1000 --rm --mount type=volume,src=output-volume,dst=/usr/local/myapp --mount type=bind,source=/var/jenkins_home/workspace/artifacts,dst=/usr/local/copy -u root:root -w /var/jenkins_home/workspace/Projekt@2 -v /var/jenkins_home/workspace/Projekt@2:/var/jenkins_home/workspace/Projekt@2:rw,z -v /var/jenkins_home/workspace/Projekt@2@tmp:/var/jenkins_home/workspace/Projekt@2@tmp:rw,z -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** node:alpine cat
$ docker top ba128caa0b61728cac42557aa8cfad003010ef1370d9b1426312465fa19b318f -eo pid,comm
[Pipeline] {
[Pipeline] sh
+ apk add git
fetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz
(1/7) Installing ca-certificates (20211220-r0)
(2/7) Installing brotli-libs (1.0.9-r6)
(3/7) Installing nghttp2-libs (1.47.0-r0)
(4/7) Installing libcurl (7.83.1-r1)
(5/7) Installing expat (2.4.8-r0)
(6/7) Installing pcre2 (10.39-r0)
(7/7) Installing git (2.36.1-r0)
Executing busybox-1.35.0-r13.trigger
Executing ca-certificates-20211220-r0.trigger
OK: 21 MiB in 23 packages
[Pipeline] sh
+ git config --global user.email you@example.com
[Pipeline] sh
+ git config --global user.name 'Your Name'
[Pipeline] sh
+ rm -rf /usr/local/copy/apollo-server-monorepo-1.0.0.tgz
[Pipeline] sh
+ cd /usr/local/myapp/apollo-server
+ npm version --allow-same-version 1.0.0
v1.0.0
+ npm pack
npm notice 
npm notice package: apollo-server-monorepo@1.0.0
npm notice === Tarball Contents === 
npm notice 5.6kB   .circleci/config.yml                                                                 
npm notice 993B    .codesandbox/ci.json                                                                 
npm notice 168B    .editorconfig                                                                        
npm notice 992B    .envrc                                                                               
npm notice 1.4kB   .github/APOLLO_RELEASE_TEMPLATE.md                                                   
npm notice 286B    .github/CODEOWNERS                                                                   
npm notice 1.5kB   .github/ISSUE_TEMPLATE.md                                                            
npm notice 1.3kB   .github/ISSUE_TEMPLATE/bug.md                                                        
npm notice 539B    .github/ISSUE_TEMPLATE/config.yml                                                    
npm notice 1.6kB   .github/ISSUE_TEMPLATE/feature-request.md                                            
npm notice 2.5kB   .github/PULL_REQUEST_TEMPLATE.md                                                     
npm notice 326B    .github/workflows/docs-publish.yml                                                   
npm notice 4B      .nvmrc                                                                               
npm notice 108B    .prettierignore                                                                      
npm notice 53B     .prettierrc.json5                                                                    
npm notice 67B     .vscode/extensions.json                                                              
npm notice 339B    .vscode/settings.json                                                                
npm notice 765B    .vscode/tasks.json                                                                   
npm notice 150.9kB CHANGELOG.md                                                                         
npm notice 10.3kB  CONTRIBUTING.md                                                                      
npm notice 5.4kB   DEVELOPMENT.md                                                                       
npm notice 1.1kB   LICENSE                                                                              
npm notice 19.4kB  ROADMAP.md                                                                           
npm notice 47.2MB  apollo-server-monorepo-1.0.1.tgz                                                     
npm notice 439B    codecov.yml                                                                          
npm notice 301B    codegen.yml                                                                          
npm notice 1.7kB   cspell-dict.txt                                                                      
npm notice 1.1kB   cspell.yaml                                                                          
npm notice 319B    docs/README.md                                                                       
npm notice 280.5kB docs/sketch/APQs.sketch                                                              
npm notice 2.9kB   docs/source/_redirects                                                               
npm notice 28.8kB  docs/source/api/apollo-server.mdx                                                    
npm notice 84B     docs/source/api/graphql-subscriptions.md                                             
npm notice 3.9kB   docs/source/api/plugin/cache-control.md                                              
npm notice 3.2kB   docs/source/api/plugin/drain-http-server.mdx                                         
npm notice 4.0kB   docs/source/api/plugin/inline-trace.md                                               
npm notice 13.8kB  docs/source/api/plugin/landing-pages.md                                              
npm notice 4.0kB   docs/source/api/plugin/schema-reporting.md                                           
npm notice 19.0kB  docs/source/api/plugin/usage-reporting.md                                            
npm notice 2.6kB   docs/source/builtin-plugins.md                                                       
npm notice 2.9kB   docs/source/config.json                                                              
npm notice 15.0kB  docs/source/data/data-sources.mdx                                                    
npm notice 16.1kB  docs/source/data/errors.mdx                                                          
npm notice 7.4kB   docs/source/data/file-uploads.mdx                                                    
npm notice 16.2kB  docs/source/data/resolvers.mdx                                                       
npm notice 32.1kB  docs/source/data/subscriptions.mdx                                                   
npm notice 8.1kB   docs/source/deployment/azure-functions.mdx                                           
npm notice 5.8kB   docs/source/deployment/gcp-functions.mdx                                             
npm notice 5.8kB   docs/source/deployment/heroku.md                                                     
npm notice 8.2kB   docs/source/deployment/lambda.md                                                     
npm notice 8.5kB   docs/source/getting-started.mdx                                                      
npm notice 79.1kB  docs/source/images/as-landing-page-production.jpg                                    
npm notice 149.8kB docs/source/images/as-landing-page.jpg                                               
npm notice 70.8kB  docs/source/images/deployment/heroku/add-integration.png                             
npm notice 169.3kB docs/source/images/deployment/heroku/automatic-deployment.png                        
npm notice 33.3kB  docs/source/images/deployment/heroku/config-vars.jpg                                 
npm notice 46.5kB  docs/source/images/deployment/heroku/create-new-app.png                              
npm notice 444.0kB docs/source/images/deployment/heroku/heroku-github-instructions.png                  
npm notice 18.7kB  docs/source/images/deployment/heroku/new-app.png                                     
npm notice 62.2kB  docs/source/images/deployment/heroku/set-app-name.png                                
npm notice 259.5kB docs/source/images/deployment/zeit/now-github-permissions.png                        
npm notice 378.3kB docs/source/images/deployment/zeit/zeit-apollo-server.png                            
npm notice 64.5kB  docs/source/images/features/error-code.png                                           
npm notice 358.2kB docs/source/images/features/error-stacktrace.png                                     
npm notice 360.1kB docs/source/images/features/error-user-input.png                                     
npm notice 53.0kB  docs/source/images/frontend_backend_diagram.svg                                      
npm notice 66.5kB  docs/source/images/graphiql-casual-mocks.png                                         
npm notice 361.6kB docs/source/images/graphql-playground.png                                            
npm notice 6.0kB   docs/source/images/index-get-started.png                                             
npm notice 890B    docs/source/images/index-get-started.svg                                             
npm notice 113.6kB docs/source/images/playground.png                                                    
npm notice 58.6kB  docs/source/images/sandbox-response.jpg                                              
npm notice 93.9kB  docs/source/images/sandbox.jpg                                                       
npm notice 135.4kB docs/source/images/selectrep.png                                                     
npm notice 158.7kB docs/source/images/sitedeployinprogress.png                                          
npm notice 38.8kB  docs/source/images/welcometoreact.png                                                
npm notice 136.6kB docs/source/images/willSendResponse-flowchart.png                                    
npm notice 1.4kB   docs/source/index.mdx                                                                
npm notice 20.7kB  docs/source/integrations/middleware.mdx                                              
npm notice 16.3kB  docs/source/integrations/plugins-event-reference.md                                  
npm notice 9.1kB   docs/source/integrations/plugins.md                                                  
npm notice 56.0kB  docs/source/migration.mdx                                                            
npm notice 4.8kB   docs/source/monitoring/health-checks.md                                              
npm notice 6.2kB   docs/source/monitoring/metrics.md                                                    
npm notice 15.7kB  docs/source/performance/apq.md                                                       
npm notice 22.3kB  docs/source/performance/caching.md                                                   
npm notice 5.5kB   docs/source/proxy-configuration.md                                                   
npm notice 4.1kB   docs/source/requests.md                                                              
npm notice 9.8kB   docs/source/schema/creating-directives.mdx                                           
npm notice 7.4kB   docs/source/schema/custom-scalars.md                                                 
npm notice 3.8kB   docs/source/schema/directives.md                                                     
npm notice 22.1kB  docs/source/schema/schema.md                                                         
npm notice 7.4kB   docs/source/schema/unions-interfaces.md                                              
npm notice 12.0kB  docs/source/security/authentication.md                                               
npm notice 21.4kB  docs/source/security/cors.mdx                                                        
npm notice 2.1kB   docs/source/security/terminating-ssl.mdx                                             
npm notice 5.3kB   docs/source/testing/build-run-queries.mdx                                            
npm notice 7.8kB   docs/source/testing/mocking.md                                                       
npm notice 7.0kB   docs/source/testing/testing.mdx                                                      
npm notice 514B    jest.config.base.js                                                                  
npm notice 978B    jest.setup.js                                                                        
npm notice 200B    lerna.json                                                                           
npm notice 412B    netlify.toml                                                                         
npm notice 6.0kB   package.json                                                                         
npm notice 896B    packages/apollo-datasource-rest/package.json                                         
npm notice 6.3kB   packages/apollo-datasource-rest/README.md                                            
npm notice 5.3kB   packages/apollo-datasource-rest/src/HTTPCache.ts                                     
npm notice 163B    packages/apollo-datasource-rest/src/index.ts                                         
npm notice 8.1kB   packages/apollo-datasource-rest/src/RESTDataSource.ts                                
npm notice 881B    packages/apollo-datasource-rest/src/types/http-cache-semantics/index.d.ts            
npm notice 669B    packages/apollo-datasource/package.json                                              
npm notice 281B    packages/apollo-datasource/src/index.ts                                              
npm notice 59B     packages/apollo-reporting-protobuf/generated/index.d.ts                              
npm notice 433B    packages/apollo-reporting-protobuf/generated/index.js                                
npm notice 105.8kB packages/apollo-reporting-protobuf/generated/protobuf.d.ts                           
npm notice 324.8kB packages/apollo-reporting-protobuf/generated/protobuf.js                             
npm notice 1.2kB   packages/apollo-reporting-protobuf/package.json                                      
npm notice 2.0kB   packages/apollo-reporting-protobuf/README.md                                         
npm notice 265B    packages/apollo-reporting-protobuf/src/.editorconfig                                 
npm notice 59B     packages/apollo-reporting-protobuf/src/index.d.ts                                    
npm notice 433B    packages/apollo-reporting-protobuf/src/index.js                                      
npm notice 17.2kB  packages/apollo-reporting-protobuf/src/reports.proto                                 
npm notice 1.1kB   packages/apollo-server-azure-functions/package.json                                  
npm notice 1.9kB   packages/apollo-server-azure-functions/README.md                                     
npm notice 7.3kB   packages/apollo-server-azure-functions/src/ApolloServer.ts                           
npm notice 1.9kB   packages/apollo-server-azure-functions/src/azureFunctionApollo.ts                    
npm notice 309B    packages/apollo-server-azure-functions/src/index.ts                                  
npm notice 720B    packages/apollo-server-cache-memcached/package.json                                  
npm notice 1.0kB   packages/apollo-server-cache-memcached/README.md                                     
npm notice 1.8kB   packages/apollo-server-cache-memcached/src/index.ts                                  
npm notice 739B    packages/apollo-server-cache-redis/package.json                                      
npm notice 2.8kB   packages/apollo-server-cache-redis/README.md                                         
npm notice 3.2kB   packages/apollo-server-cache-redis/src/BaseRedisCache.ts                             
npm notice 164B    packages/apollo-server-cache-redis/src/index.ts                                      
npm notice 237B    packages/apollo-server-cache-redis/src/RedisCache.ts                                 
npm notice 652B    packages/apollo-server-cache-redis/src/RedisClusterCache.ts                          
npm notice 588B    packages/apollo-server-caching/package.json                                          
npm notice 2.4kB   packages/apollo-server-caching/README.md                                             
npm notice 249B    packages/apollo-server-caching/src/index.ts                                          
npm notice 1.8kB   packages/apollo-server-caching/src/InMemoryLRUCache.ts                               
npm notice 469B    packages/apollo-server-caching/src/KeyValueCache.ts                                  
npm notice 1.2kB   packages/apollo-server-caching/src/PrefixingKeyValueCache.ts                         
npm notice 2.2kB   packages/apollo-server-caching/src/testsuite.ts                                      
npm notice 1.0kB   packages/apollo-server-cloud-functions/package.json                                  
npm notice 7.9kB   packages/apollo-server-cloud-functions/README.md                                     
npm notice 1.4kB   packages/apollo-server-cloud-functions/src/ApolloServer.ts                           
npm notice 309B    packages/apollo-server-cloud-functions/src/index.ts                                  
npm notice 112B    packages/apollo-server-cloudflare/jest.config.js                                     
npm notice 898B    packages/apollo-server-cloudflare/package.json                                       
npm notice 1.2kB   packages/apollo-server-cloudflare/src/ApolloServer.ts                                
npm notice 1.7kB   packages/apollo-server-cloudflare/src/cloudflareApollo.ts                            
npm notice 258B    packages/apollo-server-cloudflare/src/index.ts                                       
npm notice 331B    packages/apollo-server-cloudflare/src/types/cloudflare/index.d.ts                    
npm notice 278B    packages/apollo-server-cloudflare/tsconfig.json                                      
npm notice 182B    packages/apollo-server-cloudflare/tsconfig.test.json                                 
npm notice 1.7kB   packages/apollo-server-core/package.json                                             
npm notice 909B    packages/apollo-server-core/README.md                                                
npm notice 40.6kB  packages/apollo-server-core/src/ApolloServer.ts                                      
npm notice 906B    packages/apollo-server-core/src/cachePolicy.ts                                       
npm notice 2.1kB   packages/apollo-server-core/src/determineApolloConfig.ts                             
npm notice 324B    packages/apollo-server-core/src/gql.ts                                               
npm notice 3.5kB   packages/apollo-server-core/src/graphqlOptions.ts                                    
npm notice 863B    packages/apollo-server-core/src/index.ts                                             
npm notice 1.1kB   packages/apollo-server-core/src/internalPlugin.ts                                    
npm notice 524B    packages/apollo-server-core/src/nodeHttpToRequest.ts                                 
npm notice 13.0kB  packages/apollo-server-core/src/plugin/cacheControl/index.ts                         
npm notice 1.1kB   packages/apollo-server-core/src/plugin/drainHttpServer/index.ts                      
npm notice 4.3kB   packages/apollo-server-core/src/plugin/drainHttpServer/stoppable.ts                  
npm notice 5.5kB   packages/apollo-server-core/src/plugin/index.ts                                      
npm notice 5.5kB   packages/apollo-server-core/src/plugin/inlineTrace/index.ts                          
npm notice 7.9kB   packages/apollo-server-core/src/plugin/landingPage/default/index.ts                  
npm notice 4.6kB   packages/apollo-server-core/src/plugin/landingPage/default/types.ts                  
npm notice 1.8kB   packages/apollo-server-core/src/plugin/landingPage/graphqlPlayground/index.ts        
npm notice 1.4kB   packages/apollo-server-core/src/plugin/schemaIsFederated.ts                          
npm notice 302.0kB packages/apollo-server-core/src/plugin/schemaReporting/generated/operations.d.ts     
npm notice 7.6kB   packages/apollo-server-core/src/plugin/schemaReporting/index.ts                      
npm notice 6.2kB   packages/apollo-server-core/src/plugin/schemaReporting/schemaReporter.ts             
npm notice 12.5kB  packages/apollo-server-core/src/plugin/traceTreeBuilder.ts                           
npm notice 2.7kB   packages/apollo-server-core/src/plugin/usageReporting/defaultSendOperationsAsTrace.ts
npm notice 2.8kB   packages/apollo-server-core/src/plugin/usageReporting/durationHistogram.ts           
npm notice 265B    packages/apollo-server-core/src/plugin/usageReporting/index.ts                       
npm notice 4.4kB   packages/apollo-server-core/src/plugin/usageReporting/iterateOverTrace.ts            
npm notice 2.4kB   packages/apollo-server-core/src/plugin/usageReporting/operationDerivedDataCache.ts   
npm notice 15.7kB  packages/apollo-server-core/src/plugin/usageReporting/options.ts                     
npm notice 34.9kB  packages/apollo-server-core/src/plugin/usageReporting/plugin.ts                      
npm notice 16.3kB  packages/apollo-server-core/src/plugin/usageReporting/stats.ts                       
npm notice 4.0kB   packages/apollo-server-core/src/plugin/usageReporting/traceDetails.ts                
npm notice 22.4kB  packages/apollo-server-core/src/requestPipeline.ts                                   
npm notice 19.3kB  packages/apollo-server-core/src/runHttpQuery.ts                                      
npm notice 4.8kB   packages/apollo-server-core/src/types.ts                                             
npm notice 358B    packages/apollo-server-core/src/utils/createSHA.ts                                   
npm notice 3.3kB   packages/apollo-server-core/src/utils/dispatcher.ts                                  
npm notice 580B    packages/apollo-server-core/src/utils/isNodeLike.ts                                  
npm notice 9.3kB   packages/apollo-server-core/src/utils/pluginTestHarness.ts                           
npm notice 3.0kB   packages/apollo-server-core/src/utils/schemaHash.ts                                  
npm notice 5.8kB   packages/apollo-server-core/src/utils/schemaInstrumentation.ts                       
npm notice 8.7kB   packages/apollo-server-core/src/utils/schemaManager.ts                               
npm notice 3.0kB   packages/apollo-server-env/dist/fetch.d.ts                                           
npm notice 1.4kB   packages/apollo-server-env/dist/index.browser.js                                     
npm notice 1.4kB   packages/apollo-server-env/dist/index.browser.js.map                                 
npm notice 48B     packages/apollo-server-env/dist/index.d.ts                                           
npm notice 894B    packages/apollo-server-env/dist/index.js                                             
npm notice 142B    packages/apollo-server-env/dist/index.js.map                                         
npm notice 851B    packages/apollo-server-env/dist/polyfills/fetch.js                                   
npm notice 217B    packages/apollo-server-env/dist/polyfills/fetch.js.map                               
npm notice 410B    packages/apollo-server-env/dist/polyfills/url.js                                     
npm notice 168B    packages/apollo-server-env/dist/polyfills/url.js.map                                 
npm notice 1.2kB   packages/apollo-server-env/dist/url.d.ts                                             
npm notice 772B    packages/apollo-server-env/package.json                                              
npm notice 263B    packages/apollo-server-env/README.md                                                 
npm notice 3.0kB   packages/apollo-server-env/src/fetch.d.ts                                            
npm notice 1.1kB   packages/apollo-server-env/src/index.browser.js                                      
npm notice 48B     packages/apollo-server-env/src/index.d.ts                                            
npm notice 68B     packages/apollo-server-env/src/index.ts                                              
npm notice 75B     packages/apollo-server-env/src/polyfills/fetch.js                                    
npm notice 44B     packages/apollo-server-env/src/polyfills/url.js                                      
npm notice 1.2kB   packages/apollo-server-env/src/url.d.ts                                              
npm notice 600B    packages/apollo-server-errors/package.json                                           
npm notice 9.6kB   packages/apollo-server-errors/src/index.ts                                           
npm notice 1.3kB   packages/apollo-server-express/package.json                                          
npm notice 2.2kB   packages/apollo-server-express/README.md                                             
npm notice 7.7kB   packages/apollo-server-express/src/ApolloServer.ts                                   
npm notice 463B    packages/apollo-server-express/src/index.ts                                          
npm notice 1.1kB   packages/apollo-server-fastify/package.json                                          
npm notice 1.8kB   packages/apollo-server-fastify/README.md                                             
npm notice 4.9kB   packages/apollo-server-fastify/src/ApolloServer.ts                                   
npm notice 359B    packages/apollo-server-fastify/src/index.ts                                          
npm notice 1.1kB   packages/apollo-server-hapi/package.json                                             
npm notice 2.2kB   packages/apollo-server-hapi/README.md                                                
npm notice 5.7kB   packages/apollo-server-hapi/src/ApolloServer.ts                                      
npm notice 348B    packages/apollo-server-hapi/src/index.ts                                             
npm notice 1.1kB   packages/apollo-server-integration-testsuite/dist/apolloFetch.d.ts                   
npm notice 1.1kB   packages/apollo-server-integration-testsuite/dist/apolloFetch.d.ts.map               
npm notice 3.8kB   packages/apollo-server-integration-testsuite/dist/apolloFetch.js                     
npm notice 3.4kB   packages/apollo-server-integration-testsuite/dist/apolloFetch.js.map                 
npm notice 996B    packages/apollo-server-integration-testsuite/dist/ApolloServer.d.ts                  
npm notice 1.1kB   packages/apollo-server-integration-testsuite/dist/ApolloServer.d.ts.map              
npm notice 118.3kB packages/apollo-server-integration-testsuite/dist/ApolloServer.js                    
npm notice 84.4kB  packages/apollo-server-integration-testsuite/dist/ApolloServer.js.map                
npm notice 941B    packages/apollo-server-integration-testsuite/dist/index.d.ts                         
npm notice 689B    packages/apollo-server-integration-testsuite/dist/index.d.ts.map                     
npm notice 63.6kB  packages/apollo-server-integration-testsuite/dist/index.js                           
npm notice 47.0kB  packages/apollo-server-integration-testsuite/dist/index.js.map                       
npm notice 797B    packages/apollo-server-integration-testsuite/package.json                            
npm notice 5.0kB   packages/apollo-server-integration-testsuite/src/apolloFetch.ts                      
npm notice 110.8kB packages/apollo-server-integration-testsuite/src/ApolloServer.ts                     
npm notice 54.1kB  packages/apollo-server-integration-testsuite/src/index.ts                            
npm notice 1.3kB   packages/apollo-server-koa/package.json                                              
npm notice 1.7kB   packages/apollo-server-koa/README.md                                                 
npm notice 5.9kB   packages/apollo-server-koa/src/ApolloServer.ts                                       
npm notice 307B    packages/apollo-server-koa/src/index.ts                                              
npm notice 1.1kB   packages/apollo-server-lambda/package.json                                           
npm notice 8.2kB   packages/apollo-server-lambda/README.md                                              
npm notice 2.6kB   packages/apollo-server-lambda/src/ApolloServer.ts                                    
npm notice 309B    packages/apollo-server-lambda/src/index.ts                                           
npm notice 1.0kB   packages/apollo-server-micro/package.json                                            
npm notice 4.6kB   packages/apollo-server-micro/README.md                                               
npm notice 4.4kB   packages/apollo-server-micro/src/ApolloServer.ts                                     
npm notice 287B    packages/apollo-server-micro/src/index.ts                                            
npm notice 2.4kB   packages/apollo-server-micro/src/microApollo.ts                                      
npm notice 128B    packages/apollo-server-micro/src/types.ts                                            
npm notice 452B    packages/apollo-server-plugin-base/package.json                                      
npm notice 113B    packages/apollo-server-plugin-base/README.md                                         
npm notice 6.2kB   packages/apollo-server-plugin-base/src/index.ts                                      
npm notice 922B    packages/apollo-server-plugin-response-cache/package.json                            
npm notice 564B    packages/apollo-server-plugin-response-cache/README.md                               
npm notice 12.9kB  packages/apollo-server-plugin-response-cache/src/ApolloServerPluginResponseCache.ts  
npm notice 79B     packages/apollo-server-plugin-response-cache/src/index.ts                            
npm notice 605B    packages/apollo-server-types/package.json                                            
npm notice 135B    packages/apollo-server-types/README.md                                               
npm notice 10.7kB  packages/apollo-server-types/src/index.ts                                            
npm notice 996B    packages/apollo-server/package.json                                                  
npm notice 9.8kB   packages/apollo-server/README.md                                                     
npm notice 287B    packages/apollo-server/src/exports.ts                                                
npm notice 4.2kB   packages/apollo-server/src/index.ts                                                  
npm notice 5.7kB   renovate.json5                                                                       
npm notice 699B    tsconfig.base.json                                                                   
npm notice 1.1kB   tsconfig.build.json                                                                  
npm notice 189B    tsconfig.json                                                                        
npm notice 222B    tsconfig.test.base.json                                                              
npm notice 1.4kB   tsconfig.test.json                                                                   
npm notice 225B    types/mock-req/index.d.ts                                                            
npm notice === Tarball Details === 
npm notice name:          apollo-server-monorepo                  
npm notice version:       1.0.0                                   
npm notice filename:      apollo-server-monorepo-1.0.0.tgz        
npm notice package size:  51.1 MB                                 
npm notice unpacked size: 53.7 MB                                 
npm notice shasum:        a4e3208d8ce7d9f5ad4a927635d060b671d7838c
npm notice integrity:     sha512-yKgBcUeB+nQ0W[...]ojvHKnTijV4pA==
npm notice total files:   282                                     
npm notice 
apollo-server-monorepo-1.0.0.tgz
[Pipeline] sh
+ ls /usr/local/myapp/apollo-server
CHANGELOG.md
CONTRIBUTING.md
DEVELOPMENT.md
LICENSE
README.md
ROADMAP.md
apollo-server-monorepo-1.0.0.tgz
apollo-server-monorepo-1.0.1.tgz
codecov.yml
codegen.yml
cspell-dict.txt
cspell.yaml
docs
jest.config.base.js
jest.setup.js
lerna.json
netlify.toml
node_modules
package-lock.json
package.json
packages
renovate.json5
tsconfig.base.json
tsconfig.build.json
tsconfig.json
tsconfig.test.base.json
tsconfig.test.json
types
[Pipeline] sh
+ mv /usr/local/myapp/apollo-server/apollo-server-monorepo-1.0.0.tgz /usr/local/copy
[Pipeline] dir
Running in /var/jenkins_home/workspace/artifacts
[Pipeline] {
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
$ docker stop --time=1 ba128caa0b61728cac42557aa8cfad003010ef1370d9b1426312465fa19b318f
$ docker rm -f ba128caa0b61728cac42557aa8cfad003010ef1370d9b1426312465fa19b318f
[Pipeline] // withDockerContainer
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS

